From 9ec94b1f1d31bbfe0e0b3e6f5713202c03ebd4ac Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Fri, 23 Aug 2024 11:38:33 +0200
Subject: [PATCH 01/28] Initial implementation

---
 apps/dotcom/src/utils/sharing.ts              |  12 +
 apps/dotcom/src/utils/useFileSystem.tsx       |  12 +
 .../src/examples/slides/SlidesExample.tsx     |   6 +
 .../text-search/TextSearchExample.tsx         |   3 +
 packages/tldraw/api-report.md                 |   6 +-
 packages/tldraw/src/lib/ui/TldrawUi.tsx       |   2 +
 .../ActionsMenu/DefaultActionsMenuContent.tsx |  87 ++---
 .../ui/components/CommandBar/CommandBar.tsx   | 188 ++++++++++
 .../ContextMenu/DefaultContextMenuContent.tsx |   5 +-
 .../src/lib/ui/components/EmbedDialog.tsx     |   1 +
 .../HelperButtons/BackToContent.tsx           |  27 +-
 .../HelperButtons/StopFollowing.tsx           |   9 +-
 .../MainMenu/DefaultMainMenuContent.tsx       |   7 +-
 .../DefaultQuickActionsContent.tsx            |  20 +-
 .../src/lib/ui/components/menu-items.tsx      | 159 ++-------
 .../menus/TldrawUiMenuActionItem.tsx          |   2 +-
 .../tldraw/src/lib/ui/context/actions.tsx     | 325 +++++++++++++++++-
 packages/tldraw/src/lib/ui/context/events.tsx |   1 +
 .../tldraw/src/lib/ui/hooks/menu-hooks.ts     | 140 ++++++++
 .../src/lib/ui/hooks/useKeyboardShortcuts.ts  |   5 +
 20 files changed, 752 insertions(+), 265 deletions(-)
 create mode 100644 packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx

diff --git a/apps/dotcom/src/utils/sharing.ts b/apps/dotcom/src/utils/sharing.ts
index 54931da29..4574e77db 100644
--- a/apps/dotcom/src/utils/sharing.ts
+++ b/apps/dotcom/src/utils/sharing.ts
@@ -108,6 +108,9 @@ export function useSharing(): TLUiOverrides {
 
 						navigate('/')
 					},
+					enabled() {
+						return true
+					},
 				}
 				actions[SHARE_PROJECT_ACTION] = {
 					id: SHARE_PROJECT_ACTION,
@@ -159,6 +162,9 @@ export function useSharing(): TLUiOverrides {
 							})
 						}
 					},
+					enabled() {
+						return true
+					},
 				}
 				actions[SHARE_SNAPSHOT_ACTION] = {
 					id: SHARE_SNAPSHOT_ACTION,
@@ -182,11 +188,17 @@ export function useSharing(): TLUiOverrides {
 							severity: 'success',
 						})
 					},
+					enabled() {
+						return true
+					},
 				}
 				actions[FORK_PROJECT_ACTION] = {
 					...actions[SHARE_PROJECT_ACTION],
 					id: FORK_PROJECT_ACTION,
 					label: runningInIFrame ? 'action.fork-project-on-tldraw' : 'action.fork-project',
+					enabled() {
+						return true
+					},
 				}
 				return actions
 			},
diff --git a/apps/dotcom/src/utils/useFileSystem.tsx b/apps/dotcom/src/utils/useFileSystem.tsx
index d4b7226c3..eee0fd249 100644
--- a/apps/dotcom/src/utils/useFileSystem.tsx
+++ b/apps/dotcom/src/utils/useFileSystem.tsx
@@ -69,6 +69,9 @@ export function useFileSystem({ isMultiplayer }: { isMultiplayer: boolean }): TL
 
 						await parseAndLoadDocument(editor, await file.text(), msg, addToast)
 					},
+					enabled() {
+						return !isMultiplayer
+					},
 				}
 				actions[NEW_SHARED_PROJECT_ACTION] = {
 					id: NEW_SHARED_PROJECT_ACTION,
@@ -78,6 +81,9 @@ export function useFileSystem({ isMultiplayer }: { isMultiplayer: boolean }): TL
 						handleUiEvent('create-new-shared-project', { source })
 						navigate('/new')
 					},
+					enabled() {
+						return true
+					},
 				}
 				actions[NEW_PROJECT_ACTION] = {
 					id: NEW_PROJECT_ACTION,
@@ -92,6 +98,9 @@ export function useFileSystem({ isMultiplayer }: { isMultiplayer: boolean }): TL
 							editor.clearHistory()
 						})
 					},
+					enabled() {
+						return true
+					},
 				}
 				return actions
 			},
@@ -139,5 +148,8 @@ export function getSaveFileCopyAction(
 				saveFileNames.set(editor.store, handle.name)
 			}
 		},
+		enabled() {
+			return true
+		},
 	}
 }
diff --git a/apps/examples/src/examples/slides/SlidesExample.tsx b/apps/examples/src/examples/slides/SlidesExample.tsx
index 493178898..696d70466 100644
--- a/apps/examples/src/examples/slides/SlidesExample.tsx
+++ b/apps/examples/src/examples/slides/SlidesExample.tsx
@@ -62,6 +62,9 @@ const overrides: TLUiOverrides = {
 						moveToSlide(editor, nextSlide)
 					}
 				},
+				enabled() {
+					return $slides.get().length > 1
+				},
 			},
 			'previous-slide': {
 				id: 'previous-slide',
@@ -77,6 +80,9 @@ const overrides: TLUiOverrides = {
 						moveToSlide(editor, previousSlide)
 					}
 				},
+				enabled() {
+					return $slides.get().length > 1
+				},
 			},
 		}
 	},
diff --git a/apps/examples/src/examples/text-search/TextSearchExample.tsx b/apps/examples/src/examples/text-search/TextSearchExample.tsx
index e9e5ac283..e5480bbbf 100644
--- a/apps/examples/src/examples/text-search/TextSearchExample.tsx
+++ b/apps/examples/src/examples/text-search/TextSearchExample.tsx
@@ -22,6 +22,9 @@ const overrides: TLUiOverrides = {
 						showSearch.set(true)
 					}
 				},
+				enabled() {
+					return true
+				},
 			},
 		}
 	},
diff --git a/packages/tldraw/api-report.md b/packages/tldraw/api-report.md
index c7e95a34c..c6891437f 100644
--- a/packages/tldraw/api-report.md
+++ b/packages/tldraw/api-report.md
@@ -2241,6 +2241,10 @@ export interface TLUiActionItem<TransationKey extends string = string, IconType
     // (undocumented)
     checkbox?: boolean;
     // (undocumented)
+    disabledDescription?: string;
+    // (undocumented)
+    enabled(): boolean;
+    // (undocumented)
     icon?: IconType;
     // (undocumented)
     id: string;
@@ -2746,7 +2750,7 @@ export interface TLUiEventMap {
 }
 
 // @public (undocumented)
-export type TLUiEventSource = 'actions-menu' | 'context-menu' | 'debug-panel' | 'dialog' | 'document-name' | 'export-menu' | 'help-menu' | 'helper-buttons' | 'kbd' | 'main-menu' | 'menu' | 'navigation-zone' | 'page-menu' | 'people-menu' | 'quick-actions' | 'share-menu' | 'style-panel' | 'toolbar' | 'unknown' | 'zoom-menu';
+export type TLUiEventSource = 'actions-menu' | 'command-bar' | 'context-menu' | 'debug-panel' | 'dialog' | 'document-name' | 'export-menu' | 'help-menu' | 'helper-buttons' | 'kbd' | 'main-menu' | 'menu' | 'navigation-zone' | 'page-menu' | 'people-menu' | 'quick-actions' | 'share-menu' | 'style-panel' | 'toolbar' | 'unknown' | 'zoom-menu';
 
 // @public (undocumented)
 export interface TLUiHelperButtonsProps {
diff --git a/packages/tldraw/src/lib/ui/TldrawUi.tsx b/packages/tldraw/src/lib/ui/TldrawUi.tsx
index 933fc66a8..8359aeba8 100644
--- a/packages/tldraw/src/lib/ui/TldrawUi.tsx
+++ b/packages/tldraw/src/lib/ui/TldrawUi.tsx
@@ -2,6 +2,7 @@ import { useEditor, useValue } from '@tldraw/editor'
 import classNames from 'classnames'
 import React, { ReactNode } from 'react'
 import { TLUiAssetUrlOverrides } from './assetUrls'
+import { CommmandBar } from './components/CommandBar/CommandBar'
 import { Dialogs } from './components/Dialogs'
 import { FollowingIndicator } from './components/FollowingIndicator'
 import { ToastViewport, Toasts } from './components/Toasts'
@@ -161,6 +162,7 @@ const TldrawUiContent = React.memo(function TldrawUI() {
 					</div>
 				</>
 			)}
+			<CommmandBar />
 			<Toasts />
 			<Dialogs />
 			<ToastViewport />
diff --git a/packages/tldraw/src/lib/ui/components/ActionsMenu/DefaultActionsMenuContent.tsx b/packages/tldraw/src/lib/ui/components/ActionsMenu/DefaultActionsMenuContent.tsx
index 156a0d8a1..b7cc883a2 100644
--- a/packages/tldraw/src/lib/ui/components/ActionsMenu/DefaultActionsMenuContent.tsx
+++ b/packages/tldraw/src/lib/ui/components/ActionsMenu/DefaultActionsMenuContent.tsx
@@ -1,14 +1,6 @@
-import { useEditor, useValue } from '@tldraw/editor'
 import { PORTRAIT_BREAKPOINT } from '../../constants'
 import { useBreakpoint } from '../../context/breakpoints'
-import {
-	useAllowGroup,
-	useAllowUngroup,
-	useHasLinkShapeSelected,
-	useIsInSelectState,
-	useThreeStackableItems,
-	useUnlockedSelectedShapesCount,
-} from '../../hooks/menu-hooks'
+import { useAllowGroup, useAllowUngroup } from '../../hooks/menu-hooks'
 import { TldrawUiMenuActionItem } from '../primitives/menus/TldrawUiMenuActionItem'
 
 /** @public @react */
@@ -29,64 +21,48 @@ export function DefaultActionsMenuContent() {
 
 /** @public @react */
 export function AlignMenuItems() {
-	const twoSelected = useUnlockedSelectedShapesCount(2)
-	const isInSelectState = useIsInSelectState()
-	const enabled = twoSelected && isInSelectState
-
 	return (
 		<>
-			<TldrawUiMenuActionItem actionId="align-left" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="align-center-horizontal" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="align-right" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="stretch-horizontal" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="align-top" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="align-center-vertical" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="align-bottom" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="stretch-vertical" disabled={!enabled} />
+			<TldrawUiMenuActionItem actionId="align-left" />
+			<TldrawUiMenuActionItem actionId="align-center-horizontal" />
+			<TldrawUiMenuActionItem actionId="align-right" />
+			<TldrawUiMenuActionItem actionId="stretch-horizontal" />
+			<TldrawUiMenuActionItem actionId="align-top" />
+			<TldrawUiMenuActionItem actionId="align-center-vertical" />
+			<TldrawUiMenuActionItem actionId="align-bottom" />
+			<TldrawUiMenuActionItem actionId="stretch-vertical" />
 		</>
 	)
 }
 
 /** @public @react */
 export function DistributeMenuItems() {
-	const threeSelected = useUnlockedSelectedShapesCount(3)
-	const isInSelectState = useIsInSelectState()
-	const enabled = threeSelected && isInSelectState
-
 	return (
 		<>
-			<TldrawUiMenuActionItem actionId="distribute-horizontal" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="distribute-vertical" disabled={!enabled} />
+			<TldrawUiMenuActionItem actionId="distribute-horizontal" />
+			<TldrawUiMenuActionItem actionId="distribute-vertical" />
 		</>
 	)
 }
 
 /** @public @react */
 export function StackMenuItems() {
-	const threeStackableItems = useThreeStackableItems()
-	const isInSelectState = useIsInSelectState()
-	const enabled = threeStackableItems && isInSelectState
-
 	return (
 		<>
-			<TldrawUiMenuActionItem actionId="stack-horizontal" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="stack-vertical" disabled={!enabled} />
+			<TldrawUiMenuActionItem actionId="stack-horizontal" />
+			<TldrawUiMenuActionItem actionId="stack-vertical" />
 		</>
 	)
 }
 
 /** @public @react */
 export function ReorderMenuItems() {
-	const oneSelected = useUnlockedSelectedShapesCount(1)
-	const isInSelectState = useIsInSelectState()
-	const enabled = oneSelected && isInSelectState
-
 	return (
 		<>
-			<TldrawUiMenuActionItem actionId="send-to-back" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="send-backward" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="bring-forward" disabled={!enabled} />
-			<TldrawUiMenuActionItem actionId="bring-to-front" disabled={!enabled} />
+			<TldrawUiMenuActionItem actionId="send-to-back" />
+			<TldrawUiMenuActionItem actionId="send-backward" />
+			<TldrawUiMenuActionItem actionId="bring-forward" />
+			<TldrawUiMenuActionItem actionId="bring-to-front" />
 		</>
 	)
 }
@@ -100,37 +76,22 @@ export function ZoomOrRotateMenuItem() {
 /** @public @react */
 
 export function ZoomTo100MenuItem() {
-	const editor = useEditor()
-	const isZoomedTo100 = useValue('zoom is 1', () => editor.getZoomLevel() === 1, [editor])
-
-	return <TldrawUiMenuActionItem actionId="zoom-to-100" disabled={isZoomedTo100} />
+	return <TldrawUiMenuActionItem actionId="zoom-to-100" />
 }
 /** @public @react */
 
 export function RotateCCWMenuItem() {
-	const oneSelected = useUnlockedSelectedShapesCount(1)
-	const isInSelectState = useIsInSelectState()
-	const enabled = oneSelected && isInSelectState
-
-	return <TldrawUiMenuActionItem actionId="rotate-ccw" disabled={!enabled} />
+	return <TldrawUiMenuActionItem actionId="rotate-ccw" />
 }
 /** @public @react */
 
 export function RotateCWMenuItem() {
-	const oneSelected = useUnlockedSelectedShapesCount(1)
-	const isInSelectState = useIsInSelectState()
-	const enabled = oneSelected && isInSelectState
-
-	return <TldrawUiMenuActionItem actionId="rotate-cw" disabled={!enabled} />
+	return <TldrawUiMenuActionItem actionId="rotate-cw" />
 }
 /** @public @react */
 
 export function EditLinkMenuItem() {
-	const showEditLink = useHasLinkShapeSelected()
-	const isInSelectState = useIsInSelectState()
-	const enabled = showEditLink && isInSelectState
-
-	return <TldrawUiMenuActionItem actionId="edit-link" disabled={!enabled} />
+	return <TldrawUiMenuActionItem actionId="edit-link" />
 }
 /** @public @react */
 
@@ -142,11 +103,7 @@ export function GroupOrUngroupMenuItem() {
 /** @public @react */
 
 export function GroupMenuItem() {
-	const twoSelected = useUnlockedSelectedShapesCount(2)
-	const isInSelectState = useIsInSelectState()
-	const enabled = twoSelected && isInSelectState
-
-	return <TldrawUiMenuActionItem actionId="group" disabled={!enabled} />
+	return <TldrawUiMenuActionItem actionId="group" />
 }
 /** @public @react */
 
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
new file mode 100644
index 000000000..495e9476e
--- /dev/null
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
@@ -0,0 +1,188 @@
+import { useEditor } from '@tldraw/editor'
+import { useCallback, useState } from 'react'
+import { unwrapLabel, useActions } from '../../context/actions'
+import { useMenuIsOpen } from '../../hooks/useMenuIsOpen'
+import { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'
+import { useTranslation } from '../../hooks/useTranslation/useTranslation'
+import { TldrawUiButton } from '../primitives/Button/TldrawUiButton'
+import { TldrawUiButtonLabel } from '../primitives/Button/TldrawUiButtonLabel'
+import { TldrawUiKbd } from '../primitives/TldrawUiKbd'
+
+export const COMMAND_BAR_ID = 'command bar'
+
+export function CommmandBar() {
+	const actions = useActions()
+	const editor = useEditor()
+	const [isOpen] = useMenuIsOpen(COMMAND_BAR_ID)
+	const msg = useTranslation()
+	const [selected, setSelected] = useState(-1)
+	const [search, setSearch] = useState('')
+	const filteredActions = Object.values(actions)
+		.filter((action) => {
+			// if (!action.enabled?.()) return false
+			const unwrapped = unwrapLabel(action.label, 'default')
+			const value = msg(unwrapped as TLUiTranslationKey)
+			if (!value) return false
+			if (search === '') return true
+			return value.toLowerCase().includes(search.toLowerCase())
+		})
+		.sort((a, b) => {
+			if (!a.enabled?.()) {
+				return 1
+			}
+			if (!b.enabled?.()) {
+				return -1
+			}
+			return 0
+		})
+
+	const handleKeyDown = useCallback(
+		(e: React.KeyboardEvent) => {
+			switch (e.key) {
+				case 'Escape':
+					editor.deleteOpenMenu(COMMAND_BAR_ID)
+					break
+				case 'Tab':
+					if (e.shiftKey) {
+						e.preventDefault()
+						const next = selected - 1
+						setSelected(next < 0 ? filteredActions.length - 1 : next)
+					} else {
+						e.preventDefault()
+						setSelected((selected + 1) % filteredActions.length)
+					}
+					break
+				case 'ArrowUp':
+					{
+						e.preventDefault()
+						const next = selected - 1
+						setSelected(next < 0 ? filteredActions.length - 1 : next)
+					}
+					break
+				case 'ArrowDown':
+					e.preventDefault()
+					setSelected((selected + 1) % filteredActions.length)
+					break
+
+				case 'Enter': {
+					const action = filteredActions[selected]
+					if (!action || !action.enabled?.()) return
+					editor.deleteOpenMenu(COMMAND_BAR_ID)
+					action.onSelect('command-bar')
+					setSearch('')
+					setSelected(-1)
+					break
+				}
+			}
+		},
+		[editor, filteredActions, selected]
+	)
+
+	if (!isOpen) return null
+
+	return (
+		<div
+			style={{
+				position: 'absolute',
+				inset: 0,
+				display: 'flex',
+				alignItems: 'center',
+				justifyContent: 'center',
+				zIndex: 'var(--layer-panels)',
+			}}
+		>
+			<div style={{ height: '300px' }}>
+				<div
+					style={{
+						pointerEvents: 'all',
+						boxShadow: 'var(--shadow-2)',
+						overflow: 'hidden',
+						borderRadius: 'var(--radius-3)',
+						background: 'var(--color-background)',
+					}}
+				>
+					<div
+						style={{
+							padding: '4px',
+							height: 'fit-content',
+							width: '300px',
+							display: 'flex',
+							flexDirection: 'column',
+							gap: '8px',
+						}}
+						onKeyDown={handleKeyDown}
+					>
+						<input
+							autoFocus
+							type="text"
+							value={search}
+							placeholder="Search..."
+							style={{
+								width: '100%',
+								border: 'none',
+								padding: '8px',
+								background: 'var(--color-background)',
+								color: 'var(--color-text-1)',
+							}}
+							onChange={(e) => {
+								const value = e.target.value
+								setSearch(value)
+								if (selected === -1) {
+									setSelected(0)
+								}
+								if (value === '') setSelected(-1)
+							}}
+						/>
+						{filteredActions.length !== 0 && (
+							<div>
+								{filteredActions.slice(0, 6).map((action, i) => {
+									const { id, label, kbd } = action
+									const enabled = action.enabled?.()
+
+									const labelToUse = unwrapLabel(label, 'default')
+
+									const labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined
+
+									return (
+										<div
+											key={id}
+											style={{
+												color: enabled ? 'var(--color-text-1)' : '#aaa',
+												overflow: 'visible',
+											}}
+										>
+											<div
+												style={{
+													background:
+														i === selected ? 'var(--color-hint)' : 'var(--color-background)',
+													borderRadius: 'var(--radius-2)',
+													display: 'flex',
+													alignItems: 'center',
+												}}
+											>
+												<TldrawUiButton type="menu" disabled={!enabled}>
+													<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>
+													{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}
+												</TldrawUiButton>
+											</div>
+											{selected === i && !enabled && action.disabledDescription && (
+												<span
+													style={{
+														fontSize: '10px',
+														padding: '4px',
+													}}
+												>
+													{action.disabledDescription}
+												</span>
+											)}
+										</div>
+									)
+								})}
+							</div>
+						)}
+					</div>
+				</div>
+			</div>
+		</div>
+	)
+}
diff --git a/packages/tldraw/src/lib/ui/components/ContextMenu/DefaultContextMenuContent.tsx b/packages/tldraw/src/lib/ui/components/ContextMenu/DefaultContextMenuContent.tsx
index 168e77ef2..e019ae12c 100644
--- a/packages/tldraw/src/lib/ui/components/ContextMenu/DefaultContextMenuContent.tsx
+++ b/packages/tldraw/src/lib/ui/components/ContextMenu/DefaultContextMenuContent.tsx
@@ -1,4 +1,5 @@
 import { useEditor, useValue } from '@tldraw/editor'
+import { useIsSinglePageMode } from '../../hooks/menu-hooks'
 import { useShowCollaborationUi } from '../../hooks/useIsMultiplayer'
 import {
 	ArrangeMenuSubmenu,
@@ -22,9 +23,7 @@ export function DefaultContextMenuContent() {
 		() => editor.getCurrentToolId() === 'select',
 		[editor]
 	)
-	const isSinglePageMode = useValue('isSinglePageMode', () => editor.options.maxPages <= 1, [
-		editor,
-	])
+	const isSinglePageMode = useIsSinglePageMode()
 
 	if (!selectToolActive) return null
 
diff --git a/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx b/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx
index 300b46803..c56189445 100644
--- a/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx
+++ b/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx
@@ -24,6 +24,7 @@ import { TldrawUiIcon } from './primitives/TldrawUiIcon'
 import { TldrawUiInput } from './primitives/TldrawUiInput'
 
 export const EmbedDialog = track(function EmbedDialog({ onClose }: TLUiDialogProps) {
+	console.log('embed dialog')
 	const editor = useEditor()
 	const msg = useTranslation()
 	const assetUrls = useAssetUrls()
diff --git a/packages/tldraw/src/lib/ui/components/HelperButtons/BackToContent.tsx b/packages/tldraw/src/lib/ui/components/HelperButtons/BackToContent.tsx
index 48f4472d5..b4c9fb9b4 100644
--- a/packages/tldraw/src/lib/ui/components/HelperButtons/BackToContent.tsx
+++ b/packages/tldraw/src/lib/ui/components/HelperButtons/BackToContent.tsx
@@ -1,34 +1,11 @@
-import { useEditor, useQuickReactor } from '@tldraw/editor'
-import { useRef, useState } from 'react'
 import { useActions } from '../../context/actions'
+import { useShowBackToContent } from '../../hooks/menu-hooks'
 import { TldrawUiMenuActionItem } from '../primitives/menus/TldrawUiMenuActionItem'
 
 export function BackToContent() {
-	const editor = useEditor()
-
 	const actions = useActions()
 
-	const [showBackToContent, setShowBackToContent] = useState(false)
-	const rIsShowing = useRef(false)
-
-	useQuickReactor(
-		'toggle showback to content',
-		() => {
-			const showBackToContentPrev = rIsShowing.current
-			const shapeIds = editor.getCurrentPageShapeIds()
-			let showBackToContentNow = false
-			if (shapeIds.size) {
-				showBackToContentNow = shapeIds.size === editor.getCulledShapes().size
-			}
-
-			if (showBackToContentPrev !== showBackToContentNow) {
-				setShowBackToContent(showBackToContentNow)
-				rIsShowing.current = showBackToContentNow
-			}
-		},
-		[editor]
-	)
-
+	const [showBackToContent, setShowBackToContent] = useShowBackToContent()
 	if (!showBackToContent) return null
 
 	return (
diff --git a/packages/tldraw/src/lib/ui/components/HelperButtons/StopFollowing.tsx b/packages/tldraw/src/lib/ui/components/HelperButtons/StopFollowing.tsx
index aceb89c0f..390c20d91 100644
--- a/packages/tldraw/src/lib/ui/components/HelperButtons/StopFollowing.tsx
+++ b/packages/tldraw/src/lib/ui/components/HelperButtons/StopFollowing.tsx
@@ -1,16 +1,11 @@
-import { useEditor, useValue } from '@tldraw/editor'
 import { useActions } from '../../context/actions'
+import { useIsFollowingUser } from '../../hooks/menu-hooks'
 import { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'
 
 export function StopFollowing() {
-	const editor = useEditor()
 	const actions = useActions()
 
-	const followingUser = useValue(
-		'is following user',
-		() => !!editor.getInstanceState().followingUserId,
-		[editor]
-	)
+	const followingUser = useIsFollowingUser()
 	if (!followingUser) return null
 
 	return <TldrawUiMenuItem {...actions['stop-following']} />
diff --git a/packages/tldraw/src/lib/ui/components/MainMenu/DefaultMainMenuContent.tsx b/packages/tldraw/src/lib/ui/components/MainMenu/DefaultMainMenuContent.tsx
index 15ba4fabe..a268495ff 100644
--- a/packages/tldraw/src/lib/ui/components/MainMenu/DefaultMainMenuContent.tsx
+++ b/packages/tldraw/src/lib/ui/components/MainMenu/DefaultMainMenuContent.tsx
@@ -1,5 +1,4 @@
 import { useEditor, useValue } from '@tldraw/editor'
-import { useCanRedo, useCanUndo } from '../../hooks/menu-hooks'
 import { ColorSchemeMenu } from '../ColorSchemeMenu'
 import { KeyboardShortcutsMenuItem } from '../HelpMenu/DefaultHelpMenuContent'
 import { LanguageMenu } from '../LanguageMenu'
@@ -119,12 +118,10 @@ export function LockGroup() {
 
 /** @public @react */
 export function UndoRedoGroup() {
-	const canUndo = useCanUndo()
-	const canRedo = useCanRedo()
 	return (
 		<TldrawUiMenuGroup id="undo-redo">
-			<TldrawUiMenuActionItem actionId="undo" disabled={!canUndo} />
-			<TldrawUiMenuActionItem actionId="redo" disabled={!canRedo} />
+			<TldrawUiMenuActionItem actionId="undo" />
+			<TldrawUiMenuActionItem actionId="redo" />
 		</TldrawUiMenuGroup>
 	)
 }
diff --git a/packages/tldraw/src/lib/ui/components/QuickActions/DefaultQuickActionsContent.tsx b/packages/tldraw/src/lib/ui/components/QuickActions/DefaultQuickActionsContent.tsx
index f3a003fed..35d564295 100644
--- a/packages/tldraw/src/lib/ui/components/QuickActions/DefaultQuickActionsContent.tsx
+++ b/packages/tldraw/src/lib/ui/components/QuickActions/DefaultQuickActionsContent.tsx
@@ -1,10 +1,4 @@
 import { useEditor, useValue } from '@tldraw/editor'
-import {
-	useCanRedo,
-	useCanUndo,
-	useIsInSelectState,
-	useUnlockedSelectedShapesCount,
-} from '../../hooks/menu-hooks'
 import { useReadonly } from '../../hooks/useReadonly'
 import { TldrawUiMenuActionItem } from '../primitives/menus/TldrawUiMenuActionItem'
 
@@ -12,10 +6,6 @@ import { TldrawUiMenuActionItem } from '../primitives/menus/TldrawUiMenuActionIt
 export function DefaultQuickActionsContent() {
 	const editor = useEditor()
 
-	const canUndo = useCanUndo()
-	const canRedo = useCanRedo()
-	const oneSelected = useUnlockedSelectedShapesCount(1)
-
 	const isReadonlyMode = useReadonly()
 
 	const isInAcceptableReadonlyState = useValue(
@@ -23,17 +13,15 @@ export function DefaultQuickActionsContent() {
 		() => editor.isInAny('select', 'hand', 'zoom'),
 		[editor]
 	)
-	const isInSelectState = useIsInSelectState()
-	const selectDependentActionsEnabled = oneSelected && isInSelectState
 
 	if (isReadonlyMode && !isInAcceptableReadonlyState) return
 
 	return (
 		<>
-			<TldrawUiMenuActionItem actionId="undo" disabled={!canUndo} />
-			<TldrawUiMenuActionItem actionId="redo" disabled={!canRedo} />
-			<TldrawUiMenuActionItem actionId="delete" disabled={!selectDependentActionsEnabled} />
-			<TldrawUiMenuActionItem actionId="duplicate" disabled={!selectDependentActionsEnabled} />
+			<TldrawUiMenuActionItem actionId="undo" />
+			<TldrawUiMenuActionItem actionId="redo" />
+			<TldrawUiMenuActionItem actionId="delete" />
+			<TldrawUiMenuActionItem actionId="duplicate" />
 		</>
 	)
 }
diff --git a/packages/tldraw/src/lib/ui/components/menu-items.tsx b/packages/tldraw/src/lib/ui/components/menu-items.tsx
index 2e2e7bcd1..52f1d3817 100644
--- a/packages/tldraw/src/lib/ui/components/menu-items.tsx
+++ b/packages/tldraw/src/lib/ui/components/menu-items.tsx
@@ -1,26 +1,22 @@
-import {
-	TLBookmarkShape,
-	TLEmbedShape,
-	TLFrameShape,
-	TLImageShape,
-	TLPageId,
-	useEditor,
-	useValue,
-} from '@tldraw/editor'
+import { TLPageId, useEditor, useValue } from '@tldraw/editor'
+import { useActions } from '../context/actions'
 import { useUiEvents } from '../context/events'
 import { useToasts } from '../context/toasts'
 import {
-	showMenuPaste,
 	useAllowGroup,
 	useAllowUngroup,
 	useAnySelectedShapesCount,
+	useCanFitFrameToContent,
+	useCanFlattenToImage,
+	useCanRemoveFrame,
 	useHasLinkShapeSelected,
+	useOneEmbedSelected,
+	useOneEmbeddableBookmarkSelected,
 	useOnlyFlippableShape,
 	useShowAutoSizeToggle,
 	useThreeStackableItems,
 	useUnlockedSelectedShapesCount,
 } from '../hooks/menu-hooks'
-import { useGetEmbedDefinition } from '../hooks/useGetEmbedDefinition'
 import { TldrawUiMenuActionCheckboxItem } from './primitives/menus/TldrawUiMenuActionCheckboxItem'
 import { TldrawUiMenuActionItem } from './primitives/menus/TldrawUiMenuActionItem'
 import { TldrawUiMenuGroup } from './primitives/menus/TldrawUiMenuGroup'
@@ -50,20 +46,7 @@ export function DuplicateMenuItem() {
 }
 /** @public @react */
 export function FlattenMenuItem() {
-	const editor = useEditor()
-	const shouldDisplay = useValue(
-		'should display flatten option',
-		() => {
-			const selectedShapeIds = editor.getSelectedShapeIds()
-			if (selectedShapeIds.length === 0) return false
-			const onlySelectedShape = editor.getOnlySelectedShape()
-			if (onlySelectedShape && editor.isShapeOfType<TLImageShape>(onlySelectedShape, 'image')) {
-				return false
-			}
-			return true
-		},
-		[editor]
-	)
+	const shouldDisplay = useCanFlattenToImage()
 	if (!shouldDisplay) return null
 
 	return <TldrawUiMenuActionItem actionId="flatten-to-image" />
@@ -84,35 +67,14 @@ export function UngroupMenuItem() {
 }
 /** @public @react */
 export function RemoveFrameMenuItem() {
-	const editor = useEditor()
-	const shouldDisplay = useValue(
-		'allow unframe',
-		() => {
-			const selectedShapes = editor.getSelectedShapes()
-			if (selectedShapes.length === 0) return false
-			return selectedShapes.every((shape) => editor.isShapeOfType<TLFrameShape>(shape, 'frame'))
-		},
-		[editor]
-	)
+	const shouldDisplay = useCanRemoveFrame()
 	if (!shouldDisplay) return null
 
 	return <TldrawUiMenuActionItem actionId="remove-frame" />
 }
 /** @public @react */
 export function FitFrameToContentMenuItem() {
-	const editor = useEditor()
-	const shouldDisplay = useValue(
-		'allow fit frame to content',
-		() => {
-			const onlySelectedShape = editor.getOnlySelectedShape()
-			if (!onlySelectedShape) return false
-			return (
-				editor.isShapeOfType<TLFrameShape>(onlySelectedShape, 'frame') &&
-				editor.getSortedChildIdsForParent(onlySelectedShape).length > 0
-			)
-		},
-		[editor]
-	)
+	const shouldDisplay = useCanFitFrameToContent()
 	if (!shouldDisplay) return null
 
 	return <TldrawUiMenuActionItem actionId="fit-frame-to-content" />
@@ -145,31 +107,19 @@ export function ToggleTransparentBgMenuItem() {
 }
 /** @public @react */
 export function UnlockAllMenuItem() {
-	const editor = useEditor()
-	const shouldDisplay = useValue('any shapes', () => editor.getCurrentPageShapeIds().size > 0, [
-		editor,
-	])
-
-	return <TldrawUiMenuActionItem actionId="unlock-all" disabled={!shouldDisplay} />
+	return <TldrawUiMenuActionItem actionId="unlock-all" />
 }
 
 /* ---------------------- Zoom ---------------------- */
 /** @public @react */
 export function ZoomTo100MenuItem() {
-	const editor = useEditor()
-	const isZoomedTo100 = useValue('zoomed to 100', () => editor.getZoomLevel() === 1, [editor])
-
-	return <TldrawUiMenuActionItem actionId="zoom-to-100" noClose disabled={isZoomedTo100} />
+	return <TldrawUiMenuActionItem actionId="zoom-to-100" noClose />
 }
 /** @public @react */
 export function ZoomToFitMenuItem() {
-	const editor = useEditor()
-	const hasShapes = useValue('has shapes', () => editor.getCurrentPageShapeIds().size > 0, [editor])
-
 	return (
 		<TldrawUiMenuActionItem
 			actionId="zoom-to-fit"
-			disabled={!hasShapes}
 			data-testid="minimap.zoom-menu.zoom-to-fit"
 			noClose
 		/>
@@ -177,15 +127,9 @@ export function ZoomToFitMenuItem() {
 }
 /** @public @react */
 export function ZoomToSelectionMenuItem() {
-	const editor = useEditor()
-	const hasSelected = useValue('has shapes', () => editor.getSelectedShapeIds().length > 0, [
-		editor,
-	])
-
 	return (
 		<TldrawUiMenuActionItem
 			actionId="zoom-to-selection"
-			disabled={!hasSelected}
 			data-testid="minimap.zoom-menu.zoom-to-selection"
 			noClose
 		/>
@@ -239,23 +183,17 @@ export function CopyAsMenuGroup() {
 
 /** @public @react */
 export function CutMenuItem() {
-	const shouldDisplay = useUnlockedSelectedShapesCount(1)
-
-	return <TldrawUiMenuActionItem actionId="cut" disabled={!shouldDisplay} />
+	return <TldrawUiMenuActionItem actionId="cut" />
 }
 
 /** @public @react */
 export function CopyMenuItem() {
-	const shouldDisplay = useAnySelectedShapesCount(1)
-
-	return <TldrawUiMenuActionItem actionId="copy" disabled={!shouldDisplay} />
+	return <TldrawUiMenuActionItem actionId="copy" />
 }
 
 /** @public @react */
 export function PasteMenuItem() {
-	const shouldDisplay = showMenuPaste
-
-	return <TldrawUiMenuActionItem actionId="paste" disabled={!shouldDisplay} />
+	return <TldrawUiMenuActionItem actionId="paste" />
 }
 
 /* ------------------- Conversions ------------------ */
@@ -291,22 +229,13 @@ export function ConversionsMenuGroup() {
 /* ------------------ Set Selection ----------------- */
 /** @public @react */
 export function SelectAllMenuItem() {
-	const editor = useEditor()
-	const atLeastOneShapeOnPage = useValue(
-		'atLeastOneShapeOnPage',
-		() => editor.getCurrentPageShapeIds().size > 0,
-		[editor]
-	)
-
-	return <TldrawUiMenuActionItem actionId="select-all" disabled={!atLeastOneShapeOnPage} />
+	return <TldrawUiMenuActionItem actionId="select-all" />
 }
 
 /* ------------------ Delete Group ------------------ */
 /** @public @react */
 export function DeleteMenuItem() {
-	const oneSelected = useUnlockedSelectedShapesCount(1)
-
-	return <TldrawUiMenuActionItem actionId="delete" disabled={!oneSelected} />
+	return <TldrawUiMenuActionItem actionId="delete" />
 }
 
 /* --------------------- Modify --------------------- */
@@ -465,46 +394,14 @@ export function MoveToPageMenu() {
 
 /** @public @react */
 export function ConvertToBookmarkMenuItem() {
-	const editor = useEditor()
-
-	const oneEmbedSelected = useValue(
-		'oneEmbedSelected',
-		() => {
-			const onlySelectedShape = editor.getOnlySelectedShape()
-			if (!onlySelectedShape) return false
-			return !!(
-				editor.isShapeOfType<TLEmbedShape>(onlySelectedShape, 'embed') &&
-				onlySelectedShape.props.url &&
-				!editor.isShapeOrAncestorLocked(onlySelectedShape)
-			)
-		},
-		[editor]
-	)
-
+	const oneEmbedSelected = useOneEmbedSelected()
 	if (!oneEmbedSelected) return null
 	return <TldrawUiMenuActionItem actionId="convert-to-bookmark" />
 }
 
 /** @public @react */
 export function ConvertToEmbedMenuItem() {
-	const editor = useEditor()
-	const getEmbedDefinition = useGetEmbedDefinition()
-
-	const oneEmbeddableBookmarkSelected = useValue(
-		'oneEmbeddableBookmarkSelected',
-		() => {
-			const onlySelectedShape = editor.getOnlySelectedShape()
-			if (!onlySelectedShape) return false
-			return !!(
-				editor.isShapeOfType<TLBookmarkShape>(onlySelectedShape, 'bookmark') &&
-				onlySelectedShape.props.url &&
-				getEmbedDefinition(onlySelectedShape.props.url) &&
-				!editor.isShapeOrAncestorLocked(onlySelectedShape)
-			)
-		},
-		[editor]
-	)
-
+	const oneEmbeddableBookmarkSelected = useOneEmbeddableBookmarkSelected()
 	if (!oneEmbeddableBookmarkSelected) return null
 
 	return <TldrawUiMenuActionItem actionId="convert-to-embed" />
@@ -610,24 +507,14 @@ export function TogglePasteAtCursorItem() {
 /* ---------------------- Print --------------------- */
 /** @public @react */
 export function PrintItem() {
-	const editor = useEditor()
-	const emptyPage = useValue('emptyPage', () => editor.getCurrentPageShapeIds().size === 0, [
-		editor,
-	])
-	return <TldrawUiMenuActionItem actionId="print" disabled={emptyPage} />
+	return <TldrawUiMenuActionItem actionId="print" />
 }
 
 /* ---------------------- Multiplayer --------------------- */
 /** @public @react */
 export function CursorChatItem() {
-	const editor = useEditor()
-	const shouldShow = useValue(
-		'show cursor chat',
-		() => editor.getCurrentToolId() === 'select' && !editor.getInstanceState().isCoarsePointer,
-		[editor]
-	)
-
-	if (!shouldShow) return null
-
+	const actions = useActions()
+	const enabled = actions['open-cursor-chat']?.enabled?.()
+	if (!enabled) return null
 	return <TldrawUiMenuActionItem actionId="open-cursor-chat" />
 }
diff --git a/packages/tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuActionItem.tsx b/packages/tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuActionItem.tsx
index ab24e6f18..4ea87d5bb 100644
--- a/packages/tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuActionItem.tsx
+++ b/packages/tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuActionItem.tsx
@@ -11,5 +11,5 @@ export function TldrawUiMenuActionItem({ actionId = '', ...rest }: TLUiMenuActio
 	const actions = useActions()
 	const action = actions[actionId]
 	if (!action) return null
-	return <TldrawUiMenuItem {...action} {...rest} />
+	return <TldrawUiMenuItem {...action} disabled={!action.enabled?.()} {...rest} />
 }
diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index f500c3005..fa52bfc64 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -24,6 +24,24 @@ import { kickoutOccludedShapes } from '../../tools/SelectTool/selectHelpers'
 import { fitFrameToContent, removeFrame } from '../../utils/frames/frames'
 import { EditLinkDialog } from '../components/EditLinkDialog'
 import { EmbedDialog } from '../components/EmbedDialog'
+import {
+	showMenuPaste,
+	useAllowGroup,
+	useAllowUngroup,
+	useCanFitFrameToContent,
+	useCanFlattenToImage,
+	useCanRemoveFrame,
+	useCanUnlockAll,
+	useHasLinkShapeSelected,
+	useIsFollowingUser,
+	useIsInSelectState,
+	useOneEmbedSelected,
+	useOneEmbeddableBookmarkSelected,
+	useOnlyFlippableShape,
+	useShowBackToContent,
+	useThreeStackableItems,
+	useUnlockedSelectedShapesCount,
+} from '../hooks/menu-hooks'
 import { useMenuClipboardEvents } from '../hooks/useClipboardEvents'
 import { useCopyAs } from '../hooks/useCopyAs'
 import { useExportAs } from '../hooks/useExportAs'
@@ -51,6 +69,8 @@ export interface TLUiActionItem<
 	readonlyOk?: boolean
 	checkbox?: boolean
 	onSelect(source: TLUiEventSource): Promise<void> | void
+	enabled(): boolean
+	disabledDescription?: string
 }
 
 /** @public */
@@ -98,6 +118,36 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 	const exportAs = useExportAs()
 	const defaultDocumentName = msg('document.default-name')
 
+	const oneSelected = useUnlockedSelectedShapesCount(1)
+	const twoSelected = useUnlockedSelectedShapesCount(2)
+	const threeSelected = useUnlockedSelectedShapesCount(3)
+	const threeStackableItems = useThreeStackableItems()
+
+	const isInSelectState = useIsInSelectState()
+	const showEditLink = useHasLinkShapeSelected()
+
+	const allowGroup = useAllowGroup()
+	const allowUngroup = useAllowUngroup()
+
+	const alignEnabled = !!(twoSelected && isInSelectState)
+	const distributeEnabled = !!(threeSelected && isInSelectState)
+	const stackingEnabled = threeStackableItems && isInSelectState
+	const reorderingEnabled = !!(oneSelected && isInSelectState)
+	const rotateEnabled = !!(oneSelected && isInSelectState)
+	const editLinkEnabled = !!oneSelected && showEditLink
+	const cursorChatEnabled =
+		editor.getCurrentToolId() === 'select' && !editor.getInstanceState().isCoarsePointer
+	const convertToEmbedEnabled = useOneEmbeddableBookmarkSelected()
+	const convertToBookmarkEnabled = useOneEmbedSelected()
+	const flattenToImagesEnabled = useCanFlattenToImage()
+	const removeFrameEnabled = useCanRemoveFrame()
+	const fitFrameToContentEnabled = useCanFitFrameToContent()
+	const unlockAllEnabled = useCanUnlockAll()
+	const pageHasShapes = editor.getCurrentPageShapeIds().size >= 1
+	const onlyFlippableShapeSelected = useOnlyFlippableShape()
+	const isFollowingUser = useIsFollowingUser()
+	const [backToContentEnabled] = useShowBackToContent()
+
 	const getEmbedDefinition = useGetEmbedDefinition()
 
 	const trackEvent = useUiEvents()
@@ -132,6 +182,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('edit-link')
 					addDialog({ component: EditLinkDialog })
 				},
+				enabled() {
+					return editLinkEnabled
+				},
 			},
 			{
 				id: 'insert-embed',
@@ -141,6 +194,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('insert-embed', { source })
 					addDialog({ component: EmbedDialog })
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'insert-media',
@@ -150,6 +206,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('insert-media', { source })
 					insertMedia()
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'undo',
@@ -160,6 +219,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('undo', { source })
 					editor.undo()
 				},
+				enabled() {
+					return editor.getCanUndo()
+				},
 			},
 			{
 				id: 'redo',
@@ -170,6 +232,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('redo', { source })
 					editor.redo()
 				},
+				enabled() {
+					return editor.getCanRedo()
+				},
 			},
 			{
 				id: 'export-as-svg',
@@ -186,6 +251,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('export-as', { format: 'svg', source })
 					exportAs(ids, 'svg', getExportName(editor, defaultDocumentName))
 				},
+				enabled() {
+					return pageHasShapes
+				},
 			},
 			{
 				id: 'export-as-png',
@@ -202,6 +270,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('export-as', { format: 'png', source })
 					exportAs(ids, 'png', getExportName(editor, defaultDocumentName))
 				},
+				enabled() {
+					return pageHasShapes
+				},
 			},
 			{
 				id: 'export-as-json',
@@ -218,6 +289,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('export-as', { format: 'json', source })
 					exportAs(ids, 'json', getExportName(editor, defaultDocumentName))
 				},
+				enabled() {
+					return pageHasShapes
+				},
 			},
 			{
 				id: 'export-all-as-svg',
@@ -238,6 +312,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						getExportName(editor, defaultDocumentName)
 					)
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'export-all-as-png',
@@ -253,6 +330,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('export-all-as', { format: 'png', source })
 					exportAs(ids, 'png', getExportName(editor, defaultDocumentName))
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'export-all-as-json',
@@ -268,6 +348,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('export-all-as', { format: 'json', source })
 					exportAs(ids, 'json', getExportName(editor, defaultDocumentName))
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'copy-as-svg',
@@ -285,6 +368,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('copy-as', { format: 'svg', source })
 					copyAs(ids, 'svg')
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'copy-as-png',
@@ -301,6 +387,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('copy-as', { format: 'png', source })
 					copyAs(ids, 'png')
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'copy-as-json',
@@ -317,6 +406,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('copy-as', { format: 'json', source })
 					copyAs(ids, 'json')
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-auto-size',
@@ -351,6 +443,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						shapes.map((shape) => shape.id)
 					)
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'open-embed-link',
@@ -372,6 +467,10 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 
 					openWindow(shape.props.url, '_blank')
 				},
+				// does not seem to be used?
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'select-zoom-tool',
@@ -388,6 +487,10 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						}
 					}
 				},
+				// does not seem to be used?
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'convert-to-bookmark',
@@ -431,6 +534,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.createShapes(createList)
 					})
 				},
+				enabled() {
+					return convertToBookmarkEnabled
+				},
 			},
 			{
 				id: 'convert-to-embed',
@@ -486,6 +592,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.createShapes(createList)
 					})
 				},
+				enabled() {
+					return convertToEmbedEnabled
+				},
 			},
 			{
 				id: 'duplicate',
@@ -533,6 +642,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						})
 					}
 				},
+				enabled() {
+					return !!(oneSelected && isInSelectState)
+				},
 			},
 			{
 				id: 'ungroup',
@@ -547,6 +659,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('ungroup')
 					editor.ungroupShapes(editor.getSelectedShapeIds())
 				},
+				enabled() {
+					return allowUngroup
+				},
 			},
 			{
 				id: 'group',
@@ -567,6 +682,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.groupShapes(editor.getSelectedShapeIds())
 					}
 				},
+				enabled() {
+					return !!(allowGroup && twoSelected && isInSelectState)
+				},
 			},
 			{
 				id: 'remove-frame',
@@ -588,6 +706,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						)
 					}
 				},
+				enabled() {
+					return removeFrameEnabled
+				},
 			},
 			{
 				id: 'fit-frame-to-content',
@@ -602,6 +723,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						fitFrameToContent(editor, onlySelectedShape.id)
 					}
 				},
+				enabled() {
+					return fitFrameToContentEnabled
+				},
 			},
 			{
 				id: 'align-left',
@@ -618,6 +742,10 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.alignShapes(selectedShapeIds, 'left')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
+				disabledDescription: 'You need to have at least two shapes selected',
 			},
 			{
 				id: 'align-center-horizontal',
@@ -637,6 +765,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.alignShapes(selectedShapeIds, 'center-horizontal')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
 			},
 			{
 				id: 'align-right',
@@ -653,6 +784,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.alignShapes(selectedShapeIds, 'right')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
 			},
 			{
 				id: 'align-center-vertical',
@@ -672,6 +806,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.alignShapes(selectedShapeIds, 'center-vertical')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
 			},
 			{
 				id: 'align-top',
@@ -688,6 +825,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.alignShapes(selectedShapeIds, 'top')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
 			},
 			{
 				id: 'align-bottom',
@@ -704,6 +844,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.alignShapes(selectedShapeIds, 'bottom')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
 			},
 			{
 				id: 'distribute-horizontal',
@@ -723,6 +866,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.distributeShapes(selectedShapeIds, 'horizontal')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return distributeEnabled
+				},
 			},
 			{
 				id: 'distribute-vertical',
@@ -742,6 +888,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.distributeShapes(selectedShapeIds, 'vertical')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return distributeEnabled
+				},
 			},
 			{
 				id: 'stretch-horizontal',
@@ -760,6 +909,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.stretchShapes(selectedShapeIds, 'horizontal')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
 			},
 			{
 				id: 'stretch-vertical',
@@ -778,6 +930,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.stretchShapes(selectedShapeIds, 'vertical')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return alignEnabled
+				},
 			},
 			{
 				id: 'flip-horizontal',
@@ -796,6 +951,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.flipShapes(selectedShapeIds, 'horizontal')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return !!(twoSelected || onlyFlippableShapeSelected)
+				},
 			},
 			{
 				id: 'flip-vertical',
@@ -811,6 +969,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.flipShapes(selectedShapeIds, 'vertical')
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return !!(twoSelected || onlyFlippableShapeSelected)
+				},
 			},
 			{
 				id: 'pack',
@@ -826,6 +987,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.packShapes(selectedShapeIds, editor.options.adjacentShapeMargin)
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return threeStackableItems
+				},
 			},
 			{
 				id: 'stack-vertical',
@@ -844,6 +1008,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.stackShapes(selectedShapeIds, 'vertical', 16)
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return stackingEnabled
+				},
 			},
 			{
 				id: 'stack-horizontal',
@@ -862,6 +1029,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.stackShapes(selectedShapeIds, 'horizontal', 16)
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return stackingEnabled
+				},
 			},
 			{
 				id: 'bring-to-front',
@@ -876,6 +1046,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('bring to front')
 					editor.bringToFront(editor.getSelectedShapeIds())
 				},
+				enabled() {
+					return reorderingEnabled
+				},
 			},
 			{
 				id: 'bring-forward',
@@ -890,6 +1063,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('bring forward')
 					editor.bringForward(editor.getSelectedShapeIds())
 				},
+				enabled() {
+					return reorderingEnabled
+				},
 			},
 			{
 				id: 'send-backward',
@@ -904,6 +1080,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('send backward')
 					editor.sendBackward(editor.getSelectedShapeIds())
 				},
+				enabled() {
+					return reorderingEnabled
+				},
 			},
 			{
 				id: 'send-to-back',
@@ -918,6 +1097,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('send to back')
 					editor.sendToBack(editor.getSelectedShapeIds())
 				},
+				enabled() {
+					return reorderingEnabled
+				},
 			},
 			{
 				id: 'cut',
@@ -930,6 +1112,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('cut')
 					cut(source)
 				},
+				enabled() {
+					return !!oneSelected
+				},
 			},
 			{
 				id: 'copy',
@@ -942,6 +1127,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 
 					copy(source)
 				},
+				enabled() {
+					return !!oneSelected
+				},
 			},
 			{
 				id: 'paste',
@@ -965,6 +1153,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 							})
 						})
 				},
+				enabled() {
+					return showMenuPaste
+				},
 			},
 			{
 				id: 'select-all',
@@ -981,6 +1172,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.selectAll()
 					})
 				},
+				enabled() {
+					return pageHasShapes
+				},
 			},
 			{
 				id: 'select-none',
@@ -994,6 +1188,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('select none')
 					editor.selectNone()
 				},
+				enabled() {
+					return !!oneSelected
+				},
 			},
 			{
 				id: 'delete',
@@ -1008,6 +1205,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.markHistoryStoppingPoint('delete')
 					editor.deleteShapes(editor.getSelectedShapeIds())
 				},
+				enabled() {
+					return !!(oneSelected && isInSelectState)
+				},
 			},
 			{
 				id: 'rotate-cw',
@@ -1025,6 +1225,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.rotateShapesBy(selectedShapeIds, HALF_PI / 2 - (dontUseOffset ? 0 : offset))
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return rotateEnabled
+				},
 			},
 			{
 				id: 'rotate-ccw',
@@ -1042,6 +1245,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.rotateShapesBy(selectedShapeIds, offsetCloseToZero ? -(HALF_PI / 2) : -offset)
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
+				enabled() {
+					return rotateEnabled
+				},
 			},
 			{
 				id: 'zoom-in',
@@ -1054,6 +1260,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						animation: { duration: editor.options.animationMediumMs },
 					})
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'zoom-out',
@@ -1066,6 +1275,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						animation: { duration: editor.options.animationMediumMs },
 					})
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'zoom-to-100',
@@ -1079,6 +1291,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						animation: { duration: editor.options.animationMediumMs },
 					})
 				},
+				enabled() {
+					return editor.getZoomLevel() === 1
+				},
 			},
 			{
 				id: 'zoom-to-fit',
@@ -1089,6 +1304,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('zoom-to-fit', { source })
 					editor.zoomToFit({ animation: { duration: editor.options.animationMediumMs } })
 				},
+				enabled() {
+					return editor.getCurrentPageShapeIds().size > 0
+				},
 			},
 			{
 				id: 'zoom-to-selection',
@@ -1102,6 +1320,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('zoom-to-selection', { source })
 					editor.zoomToSelection({ animation: { duration: editor.options.animationMediumMs } })
 				},
+				enabled() {
+					return editor.getCurrentPageShapeIds().size > 0
+				},
 			},
 			{
 				id: 'toggle-snap-mode',
@@ -1114,6 +1335,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.user.updateUserPreferences({ isSnapMode: !editor.user.getIsSnapMode() })
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-dark-mode',
@@ -1131,6 +1355,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-wrap-mode',
@@ -1146,6 +1373,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-dynamic-size-mode',
@@ -1161,6 +1391,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-paste-at-cursor',
@@ -1176,6 +1409,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-reduce-motion',
@@ -1191,6 +1427,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-edge-scrolling',
@@ -1206,6 +1445,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-transparent',
@@ -1222,6 +1464,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-tool-lock',
@@ -1235,6 +1480,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.updateInstanceState({ isToolLocked: !editor.getInstanceState().isToolLocked })
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'unlock-all',
@@ -1251,6 +1499,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.updateShapes(updates)
 					}
 				},
+				enabled() {
+					return unlockAllEnabled
+				},
 			},
 			{
 				id: 'toggle-focus-mode',
@@ -1273,6 +1524,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						})
 					})
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-grid',
@@ -1287,6 +1541,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.updateInstanceState({ isGridMode: !editor.getInstanceState().isGridMode })
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'toggle-debug-mode',
@@ -1302,6 +1559,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				checkbox: true,
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'print',
@@ -1312,6 +1572,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('print', { source })
 					printSelectionOrPages()
 				},
+				enabled() {
+					return pageHasShapes
+				},
 			},
 			{
 				id: 'exit-pen-mode',
@@ -1322,6 +1585,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('exit-pen-mode', { source })
 					editor.updateInstanceState({ isPenMode: false })
 				},
+				enabled() {
+					return editor.getInstanceState().isPenMode
+				},
 			},
 			{
 				id: 'stop-following',
@@ -1332,6 +1598,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('stop-following', { source })
 					editor.stopFollowingUser()
 				},
+				enabled() {
+					return isFollowingUser
+				},
 			},
 			{
 				id: 'back-to-content',
@@ -1347,6 +1616,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						animation: { duration: 220 },
 					})
 				},
+				enabled() {
+					return backToContentEnabled
+				},
 			},
 			{
 				id: 'toggle-lock',
@@ -1357,6 +1629,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					trackEvent('toggle-lock', { source })
 					editor.toggleLock(editor.getSelectedShapeIds())
 				},
+				enabled() {
+					return !!oneSelected
+				},
 			},
 			{
 				id: 'move-to-new-page',
@@ -1371,6 +1646,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 					trackEvent('move-to-new-page', { source })
 				},
+				enabled() {
+					return !!(oneSelected && editor.options.maxPages > 1)
+				},
 			},
 			{
 				id: 'select-white-color',
@@ -1387,6 +1665,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 					trackEvent('set-style', { source, id: style.id, value: 'white' })
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'select-fill-fill',
@@ -1403,6 +1684,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 					trackEvent('set-style', { source, id: style.id, value: 'fill' })
 				},
+				enabled() {
+					return true
+				},
 			},
 			{
 				id: 'flatten-to-image',
@@ -1425,6 +1709,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.setSelectedShapes(newShapeIds)
 					}
 				},
+				enabled() {
+					return flattenToImagesEnabled
+				},
 			},
 		]
 
@@ -1447,6 +1734,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.updateInstanceState({ isChatting: true })
 					})
 				},
+				enabled() {
+					return cursorChatEnabled
+				},
 			})
 		}
 
@@ -1458,24 +1748,47 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 
 		return actions
 	}, [
+		showCollaborationUi,
+		overrides,
 		editor,
 		trackEvent,
-		overrides,
 		addDialog,
-		addToast,
+		editLinkEnabled,
 		insertMedia,
 		exportAs,
+		defaultDocumentName,
+		pageHasShapes,
 		copyAs,
+		convertToBookmarkEnabled,
+		getEmbedDefinition,
+		convertToEmbedEnabled,
+		allowUngroup,
+		allowGroup,
+		twoSelected,
+		isInSelectState,
+		removeFrameEnabled,
+		fitFrameToContentEnabled,
+		alignEnabled,
+		distributeEnabled,
+		onlyFlippableShapeSelected,
+		threeStackableItems,
+		stackingEnabled,
+		reorderingEnabled,
 		cut,
+		oneSelected,
 		copy,
 		paste,
+		addToast,
+		msg,
+		rotateEnabled,
+		unlockAllEnabled,
 		clearDialogs,
 		clearToasts,
 		printSelectionOrPages,
-		msg,
-		defaultDocumentName,
-		showCollaborationUi,
-		getEmbedDefinition,
+		isFollowingUser,
+		backToContentEnabled,
+		flattenToImagesEnabled,
+		cursorChatEnabled,
 	])
 
 	return <ActionsContext.Provider value={asActions(actions)}>{children}</ActionsContext.Provider>
diff --git a/packages/tldraw/src/lib/ui/context/events.tsx b/packages/tldraw/src/lib/ui/context/events.tsx
index 3dd3850d3..540313cdb 100644
--- a/packages/tldraw/src/lib/ui/context/events.tsx
+++ b/packages/tldraw/src/lib/ui/context/events.tsx
@@ -21,6 +21,7 @@ export type TLUiEventSource =
 	| 'help-menu'
 	| 'helper-buttons'
 	| 'style-panel'
+	| 'command-bar'
 	| 'unknown'
 
 /** @public */
diff --git a/packages/tldraw/src/lib/ui/hooks/menu-hooks.ts b/packages/tldraw/src/lib/ui/hooks/menu-hooks.ts
index 34cd71db3..b83001e6f 100644
--- a/packages/tldraw/src/lib/ui/hooks/menu-hooks.ts
+++ b/packages/tldraw/src/lib/ui/hooks/menu-hooks.ts
@@ -1,15 +1,21 @@
 import {
 	Editor,
 	TLArrowShape,
+	TLBookmarkShape,
 	TLDrawShape,
+	TLEmbedShape,
+	TLFrameShape,
 	TLGroupShape,
 	TLImageShape,
 	TLLineShape,
 	TLTextShape,
 	useEditor,
+	useQuickReactor,
 	useValue,
 } from '@tldraw/editor'
+import { useRef, useState } from 'react'
 import { getArrowBindings } from '../../shapes/arrow/shared'
+import { useGetEmbedDefinition } from './useGetEmbedDefinition'
 
 function shapesWithUnboundArrows(editor: Editor) {
 	const selectedShapeIds = editor.getSelectedShapeIds()
@@ -217,3 +223,137 @@ export function useCanUndo() {
 	const editor = useEditor()
 	return useValue('useCanUndo', () => editor.getCanUndo(), [editor])
 }
+
+/** @public */
+export function useOneEmbeddableBookmarkSelected() {
+	const editor = useEditor()
+	const getEmbedDefinition = useGetEmbedDefinition()
+
+	return useValue(
+		'oneEmbeddableBookmarkSelected',
+		() => {
+			const onlySelectedShape = editor.getOnlySelectedShape()
+			if (!onlySelectedShape) return false
+			return !!(
+				editor.isShapeOfType<TLBookmarkShape>(onlySelectedShape, 'bookmark') &&
+				onlySelectedShape.props.url &&
+				getEmbedDefinition(onlySelectedShape.props.url) &&
+				!editor.isShapeOrAncestorLocked(onlySelectedShape)
+			)
+		},
+		[editor]
+	)
+}
+
+/** @public */
+export function useOneEmbedSelected() {
+	const editor = useEditor()
+
+	return useValue(
+		'oneEmbedSelected',
+		() => {
+			const onlySelectedShape = editor.getOnlySelectedShape()
+			if (!onlySelectedShape) return false
+			return !!(
+				editor.isShapeOfType<TLEmbedShape>(onlySelectedShape, 'embed') &&
+				onlySelectedShape.props.url &&
+				!editor.isShapeOrAncestorLocked(onlySelectedShape)
+			)
+		},
+		[editor]
+	)
+}
+
+/** @public */
+export function useCanFlattenToImage() {
+	const editor = useEditor()
+	return useValue(
+		'should display flatten option',
+		() => {
+			const selectedShapeIds = editor.getSelectedShapeIds()
+			if (selectedShapeIds.length === 0) return false
+			const onlySelectedShape = editor.getOnlySelectedShape()
+			if (onlySelectedShape && editor.isShapeOfType<TLImageShape>(onlySelectedShape, 'image')) {
+				return false
+			}
+			return true
+		},
+		[editor]
+	)
+}
+
+/** @public */
+export function useCanRemoveFrame() {
+	const editor = useEditor()
+	return useValue(
+		'allow unframe',
+		() => {
+			const selectedShapes = editor.getSelectedShapes()
+			if (selectedShapes.length === 0) return false
+			return selectedShapes.every((shape) => editor.isShapeOfType<TLFrameShape>(shape, 'frame'))
+		},
+		[editor]
+	)
+}
+
+/** @public */
+export function useCanFitFrameToContent() {
+	const editor = useEditor()
+	return useValue(
+		'allow fit frame to content',
+		() => {
+			const onlySelectedShape = editor.getOnlySelectedShape()
+			if (!onlySelectedShape) return false
+			return (
+				editor.isShapeOfType<TLFrameShape>(onlySelectedShape, 'frame') &&
+				editor.getSortedChildIdsForParent(onlySelectedShape).length > 0
+			)
+		},
+		[editor]
+	)
+}
+
+/** @public */
+export function useCanUnlockAll() {
+	const editor = useEditor()
+	return useValue('any shapes', () => editor.getCurrentPageShapeIds().size > 0, [editor])
+}
+
+/** @public */
+export function useIsSinglePageMode() {
+	const editor = useEditor()
+	return useValue('isSinglePageMode', () => editor.options.maxPages <= 1, [editor])
+}
+
+/** @public  */
+export function useIsFollowingUser() {
+	const editor = useEditor()
+	return useValue('isFollowingUser', () => !!editor.getInstanceState().followingUserId, [editor])
+}
+
+/** @public  */
+export function useShowBackToContent() {
+	const editor = useEditor()
+
+	const [showBackToContent, setShowBackToContent] = useState(false)
+	const rIsShowing = useRef(false)
+
+	useQuickReactor(
+		'toggle showback to content',
+		() => {
+			const showBackToContentPrev = rIsShowing.current
+			const shapeIds = editor.getCurrentPageShapeIds()
+			let showBackToContentNow = false
+			if (shapeIds.size) {
+				showBackToContentNow = shapeIds.size === editor.getCulledShapes().size
+			}
+
+			if (showBackToContentPrev !== showBackToContentNow) {
+				setShowBackToContent(showBackToContentNow)
+				rIsShowing.current = showBackToContentNow
+			}
+		},
+		[editor]
+	)
+	return [showBackToContent, setShowBackToContent] as const
+}
diff --git a/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts b/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts
index deee5b194..f51fe4e21 100644
--- a/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts
@@ -1,6 +1,7 @@
 import { Editor, TLPointerEventInfo, preventDefault, useEditor, useValue } from '@tldraw/editor'
 import hotkeys from 'hotkeys-js'
 import { useEffect } from 'react'
+import { COMMAND_BAR_ID } from '../components/CommandBar/CommandBar'
 import { useActions } from '../context/actions'
 import { useReadonly } from './useReadonly'
 import { useTools } from './useTools'
@@ -123,6 +124,10 @@ export function useKeyboardShortcuts() {
 			editor.dispatch(info)
 		})
 
+		hot(getHotkeysStringFromKbd('$k'), () => {
+			editor.addOpenMenu(COMMAND_BAR_ID)
+		})
+
 		return () => {
 			disposables.forEach((d) => d())
 		}
-- 
2.52.0


From 75a67493162ad49186191dc218d9b36ad6f4913f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 10:26:14 +0200
Subject: [PATCH 02/28] Move styles to css. Extract commandbar actions hook.

---
 packages/tldraw/src/lib/ui.css                |  54 +++++
 .../ui/components/CommandBar/CommandBar.tsx   | 184 +++++++-----------
 .../src/lib/ui/hooks/useCommandBarActions.ts  |  29 +++
 3 files changed, 156 insertions(+), 111 deletions(-)
 create mode 100644 packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts

diff --git a/packages/tldraw/src/lib/ui.css b/packages/tldraw/src/lib/ui.css
index 42153e7ab..cf08cd367 100644
--- a/packages/tldraw/src/lib/ui.css
+++ b/packages/tldraw/src/lib/ui.css
@@ -1779,3 +1779,57 @@
 		opacity: 1;
 	}
 }
+
+/* ------------------ Command bar ----------------- */
+.tlui-command-bar__wrapper {
+	position: absolute;
+	inset: 0;
+	display: flex;
+	align-items: center;
+	justify-content: center;
+	z-index: var(--layer-panels);
+}
+
+.tlui-command-bar__inner {
+	height: 300px;
+}
+
+.tlui-command-bar__content {
+	pointer-events: all;
+	box-shadow: var(--shadow-2);
+	overflow: hidden;
+	border-radius: var(--radius-3);
+	background: var(--color-background);
+}
+
+.tlui-command-bar__content-inner {
+	padding: var(--space-2);
+	height: fit-content;
+	width: 300px;
+	display: flex;
+	flex-direction: column;
+	gap: var(--space-3);
+}
+
+.tlui-command-bar__input {
+	width: 100%;
+	border: none;
+	padding: var(--space-3);
+	background: var(--color-background);
+	color: var(--color-text-1);
+}
+
+.tlui-command-bar__item-wrapper {
+	overflow: visible;
+}
+
+.tlui-command-bar__item {
+	border-radius: var(--radius-2);
+	display: flex;
+	align-items: center;
+}
+
+.tlui-command-bar__item-disabled-description {
+	font-size: 10px;
+	padding: var(--space-2);
+}
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
index 495e9476e..b361bcf17 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
@@ -1,6 +1,7 @@
 import { useEditor } from '@tldraw/editor'
 import { useCallback, useState } from 'react'
-import { unwrapLabel, useActions } from '../../context/actions'
+import { TLUiActionItem, unwrapLabel } from '../../context/actions'
+import { useCommandBarActions } from '../../hooks/useCommandBarActions'
 import { useMenuIsOpen } from '../../hooks/useMenuIsOpen'
 import { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'
 import { useTranslation } from '../../hooks/useTranslation/useTranslation'
@@ -11,30 +12,11 @@ import { TldrawUiKbd } from '../primitives/TldrawUiKbd'
 export const COMMAND_BAR_ID = 'command bar'
 
 export function CommmandBar() {
-	const actions = useActions()
 	const editor = useEditor()
 	const [isOpen] = useMenuIsOpen(COMMAND_BAR_ID)
-	const msg = useTranslation()
 	const [selected, setSelected] = useState(-1)
 	const [search, setSearch] = useState('')
-	const filteredActions = Object.values(actions)
-		.filter((action) => {
-			// if (!action.enabled?.()) return false
-			const unwrapped = unwrapLabel(action.label, 'default')
-			const value = msg(unwrapped as TLUiTranslationKey)
-			if (!value) return false
-			if (search === '') return true
-			return value.toLowerCase().includes(search.toLowerCase())
-		})
-		.sort((a, b) => {
-			if (!a.enabled?.()) {
-				return 1
-			}
-			if (!b.enabled?.()) {
-				return -1
-			}
-			return 0
-		})
+	const actions = useCommandBarActions(search)
 
 	const handleKeyDown = useCallback(
 		(e: React.KeyboardEvent) => {
@@ -46,26 +28,26 @@ export function CommmandBar() {
 					if (e.shiftKey) {
 						e.preventDefault()
 						const next = selected - 1
-						setSelected(next < 0 ? filteredActions.length - 1 : next)
+						setSelected(next < 0 ? actions.length - 1 : next)
 					} else {
 						e.preventDefault()
-						setSelected((selected + 1) % filteredActions.length)
+						setSelected((selected + 1) % actions.length)
 					}
 					break
 				case 'ArrowUp':
 					{
 						e.preventDefault()
 						const next = selected - 1
-						setSelected(next < 0 ? filteredActions.length - 1 : next)
+						setSelected(next < 0 ? actions.length - 1 : next)
 					}
 					break
 				case 'ArrowDown':
 					e.preventDefault()
-					setSelected((selected + 1) % filteredActions.length)
+					setSelected((selected + 1) % actions.length)
 					break
 
 				case 'Enter': {
-					const action = filteredActions[selected]
+					const action = actions[selected]
 					if (!action || !action.enabled?.()) return
 					editor.deleteOpenMenu(COMMAND_BAR_ID)
 					action.onSelect('command-bar')
@@ -75,55 +57,22 @@ export function CommmandBar() {
 				}
 			}
 		},
-		[editor, filteredActions, selected]
+		[editor, actions, selected]
 	)
 
 	if (!isOpen) return null
 
 	return (
-		<div
-			style={{
-				position: 'absolute',
-				inset: 0,
-				display: 'flex',
-				alignItems: 'center',
-				justifyContent: 'center',
-				zIndex: 'var(--layer-panels)',
-			}}
-		>
-			<div style={{ height: '300px' }}>
-				<div
-					style={{
-						pointerEvents: 'all',
-						boxShadow: 'var(--shadow-2)',
-						overflow: 'hidden',
-						borderRadius: 'var(--radius-3)',
-						background: 'var(--color-background)',
-					}}
-				>
-					<div
-						style={{
-							padding: '4px',
-							height: 'fit-content',
-							width: '300px',
-							display: 'flex',
-							flexDirection: 'column',
-							gap: '8px',
-						}}
-						onKeyDown={handleKeyDown}
-					>
+		<div className="tlui-command-bar__wrapper">
+			<div className="tlui-command-bar__inner">
+				<div className="tlui-command-bar__content">
+					<div className="tlui-command-bar__content-inner" onKeyDown={handleKeyDown}>
 						<input
 							autoFocus
 							type="text"
 							value={search}
 							placeholder="Search..."
-							style={{
-								width: '100%',
-								border: 'none',
-								padding: '8px',
-								background: 'var(--color-background)',
-								color: 'var(--color-text-1)',
-							}}
+							className="tlui-command-bar__input"
 							onChange={(e) => {
 								const value = e.target.value
 								setSearch(value)
@@ -133,56 +82,69 @@ export function CommmandBar() {
 								if (value === '') setSelected(-1)
 							}}
 						/>
-						{filteredActions.length !== 0 && (
-							<div>
-								{filteredActions.slice(0, 6).map((action, i) => {
-									const { id, label, kbd } = action
-									const enabled = action.enabled?.()
+						{actions.length !== 0 && <CommandBarItems actions={actions} selected={selected} />}
+					</div>
+				</div>
+			</div>
+		</div>
+	)
+}
+function CommandBarItems({
+	actions,
+	selected,
+}: {
+	actions: TLUiActionItem<string, string>[]
+	selected: number
+}) {
+	return (
+		<div>
+			{actions.slice(0, 6).map((action, index) => {
+				return <CommandBarItem key={action.id} action={action} index={index} selected={selected} />
+			})}
+		</div>
+	)
+}
 
-									const labelToUse = unwrapLabel(label, 'default')
+function CommandBarItem({
+	action,
+	index,
+	selected,
+}: {
+	action: TLUiActionItem<string, string>
+	index: number
+	selected: number
+}) {
+	const msg = useTranslation()
+	const { label, kbd } = action
+	const enabled = action.enabled?.()
 
-									const labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined
+	const labelToUse = unwrapLabel(label, 'default')
 
-									return (
-										<div
-											key={id}
-											style={{
-												color: enabled ? 'var(--color-text-1)' : '#aaa',
-												overflow: 'visible',
-											}}
-										>
-											<div
-												style={{
-													background:
-														i === selected ? 'var(--color-hint)' : 'var(--color-background)',
-													borderRadius: 'var(--radius-2)',
-													display: 'flex',
-													alignItems: 'center',
-												}}
-											>
-												<TldrawUiButton type="menu" disabled={!enabled}>
-													<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>
-													{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}
-												</TldrawUiButton>
-											</div>
-											{selected === i && !enabled && action.disabledDescription && (
-												<span
-													style={{
-														fontSize: '10px',
-														padding: '4px',
-													}}
-												>
-													{action.disabledDescription}
-												</span>
-											)}
-										</div>
-									)
-								})}
-							</div>
-						)}
-					</div>
-				</div>
+	const labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined
+
+	return (
+		<div
+			className="tlui-command-bar__item-wrapper"
+			style={{
+				color: enabled ? 'var(--color-text-1)' : '#aaa',
+			}}
+		>
+			<div
+				className="tlui-command-bar__item"
+				style={{
+					background: index === selected ? 'var(--color-hint)' : 'var(--color-background)',
+				}}
+			>
+				<TldrawUiButton type="menu" disabled={!enabled}>
+					<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>
+					{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}
+				</TldrawUiButton>
 			</div>
+			{selected === index && !enabled && action.disabledDescription && (
+				<span className="tlui-command-bar__item-disabled-description">
+					{action.disabledDescription}
+				</span>
+			)}
 		</div>
 	)
 }
diff --git a/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts b/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
new file mode 100644
index 000000000..6c6432259
--- /dev/null
+++ b/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
@@ -0,0 +1,29 @@
+import { unwrapLabel, useActions } from '../context/actions'
+import { TLUiTranslationKey } from './useTranslation/TLUiTranslationKey'
+import { useTranslation } from './useTranslation/useTranslation'
+
+/** @public */
+export function useCommandBarActions(search: string) {
+	const actions = useActions()
+	const msg = useTranslation()
+	return Object.values(actions)
+		.filter((action) => {
+			// If we didn't want to show the disabled actions
+			// if (!action.enabled?.()) return false
+			const unwrapped = unwrapLabel(action.label, 'default')
+			const value = msg(unwrapped as TLUiTranslationKey)
+			if (!value) return false
+			if (search === '') return true
+			return value.toLowerCase().includes(search.toLowerCase())
+		})
+		.sort((a, b) => {
+			// Enabled actions before disabled ones
+			if (!a.enabled?.()) {
+				return 1
+			}
+			if (!b.enabled?.()) {
+				return -1
+			}
+			return 0
+		})
+}
-- 
2.52.0


From 1facf847843e4b383d31b9046609cb37651fe7fc Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 10:27:09 +0200
Subject: [PATCH 03/28] Clean up search when applying action.

---
 .../tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx    | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
index b361bcf17..b7670bde0 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
@@ -49,10 +49,10 @@ export function CommmandBar() {
 				case 'Enter': {
 					const action = actions[selected]
 					if (!action || !action.enabled?.()) return
-					editor.deleteOpenMenu(COMMAND_BAR_ID)
-					action.onSelect('command-bar')
 					setSearch('')
 					setSelected(-1)
+					editor.deleteOpenMenu(COMMAND_BAR_ID)
+					action.onSelect('command-bar')
 					break
 				}
 			}
-- 
2.52.0


From ad636e0f2792acca7b4dfb87a45e732846c43b16 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 10:32:46 +0200
Subject: [PATCH 04/28] Remove console.log.

---
 packages/tldraw/src/lib/ui/components/EmbedDialog.tsx | 1 -
 1 file changed, 1 deletion(-)

diff --git a/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx b/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx
index c56189445..300b46803 100644
--- a/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx
+++ b/packages/tldraw/src/lib/ui/components/EmbedDialog.tsx
@@ -24,7 +24,6 @@ import { TldrawUiIcon } from './primitives/TldrawUiIcon'
 import { TldrawUiInput } from './primitives/TldrawUiInput'
 
 export const EmbedDialog = track(function EmbedDialog({ onClose }: TLUiDialogProps) {
-	console.log('embed dialog')
 	const editor = useEditor()
 	const msg = useTranslation()
 	const assetUrls = useAssetUrls()
-- 
2.52.0


From dd5794cb3c726675974d7a3e649e59c27b0a99cc Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 13:31:56 +0200
Subject: [PATCH 05/28] Rename and add to components.

---
 .../ui-components-hidden/UiComponentsHiddenExample.tsx        | 1 +
 packages/tldraw/api-report.md                                 | 2 ++
 packages/tldraw/src/lib/ui/TldrawUi.tsx                       | 4 ++--
 .../CommandBar/{CommandBar.tsx => DefaultCommandBar.tsx}      | 2 +-
 packages/tldraw/src/lib/ui/context/components.tsx             | 3 +++
 packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts      | 2 +-
 6 files changed, 10 insertions(+), 4 deletions(-)
 rename packages/tldraw/src/lib/ui/components/CommandBar/{CommandBar.tsx => DefaultCommandBar.tsx} (99%)

diff --git a/apps/examples/src/examples/ui-components-hidden/UiComponentsHiddenExample.tsx b/apps/examples/src/examples/ui-components-hidden/UiComponentsHiddenExample.tsx
index 1e1176add..be1a4a182 100644
--- a/apps/examples/src/examples/ui-components-hidden/UiComponentsHiddenExample.tsx
+++ b/apps/examples/src/examples/ui-components-hidden/UiComponentsHiddenExample.tsx
@@ -22,6 +22,7 @@ const components: Required<TLUiComponents> = {
 	MenuPanel: null,
 	TopPanel: null,
 	CursorChatBubble: null,
+	CommandBar: null,
 }
 
 export default function UiComponentsHiddenExample() {
diff --git a/packages/tldraw/api-report.md b/packages/tldraw/api-report.md
index c6891437f..64ea3dbab 100644
--- a/packages/tldraw/api-report.md
+++ b/packages/tldraw/api-report.md
@@ -2332,6 +2332,8 @@ export interface TLUiComponents {
     // (undocumented)
     ActionsMenu?: ComponentType<TLUiActionsMenuProps> | null;
     // (undocumented)
+    CommandBar?: ComponentType | null;
+    // (undocumented)
     ContextMenu?: ComponentType<TLUiContextMenuProps> | null;
     // (undocumented)
     CursorChatBubble?: ComponentType | null;
diff --git a/packages/tldraw/src/lib/ui/TldrawUi.tsx b/packages/tldraw/src/lib/ui/TldrawUi.tsx
index 8359aeba8..7672aefe5 100644
--- a/packages/tldraw/src/lib/ui/TldrawUi.tsx
+++ b/packages/tldraw/src/lib/ui/TldrawUi.tsx
@@ -2,7 +2,6 @@ import { useEditor, useValue } from '@tldraw/editor'
 import classNames from 'classnames'
 import React, { ReactNode } from 'react'
 import { TLUiAssetUrlOverrides } from './assetUrls'
-import { CommmandBar } from './components/CommandBar/CommandBar'
 import { Dialogs } from './components/Dialogs'
 import { FollowingIndicator } from './components/FollowingIndicator'
 import { ToastViewport, Toasts } from './components/Toasts'
@@ -111,6 +110,7 @@ const TldrawUiContent = React.memo(function TldrawUI() {
 		HelperButtons,
 		DebugPanel,
 		CursorChatBubble,
+		CommandBar,
 	} = useTldrawUiComponents()
 
 	useKeyboardShortcuts()
@@ -162,7 +162,7 @@ const TldrawUiContent = React.memo(function TldrawUI() {
 					</div>
 				</>
 			)}
-			<CommmandBar />
+			{CommandBar && <CommandBar />}
 			<Toasts />
 			<Dialogs />
 			<ToastViewport />
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
similarity index 99%
rename from packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
rename to packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index b7670bde0..b5ae7dd23 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/CommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -11,7 +11,7 @@ import { TldrawUiKbd } from '../primitives/TldrawUiKbd'
 
 export const COMMAND_BAR_ID = 'command bar'
 
-export function CommmandBar() {
+export function DefaultCommmandBar() {
 	const editor = useEditor()
 	const [isOpen] = useMenuIsOpen(COMMAND_BAR_ID)
 	const [selected, setSelected] = useState(-1)
diff --git a/packages/tldraw/src/lib/ui/context/components.tsx b/packages/tldraw/src/lib/ui/context/components.tsx
index c6d1f0946..5eb33f5d3 100644
--- a/packages/tldraw/src/lib/ui/context/components.tsx
+++ b/packages/tldraw/src/lib/ui/context/components.tsx
@@ -4,6 +4,7 @@ import {
 	DefaultActionsMenu,
 	TLUiActionsMenuProps,
 } from '../components/ActionsMenu/DefaultActionsMenu'
+import { DefaultCommmandBar } from '../components/CommandBar/DefaultCommandBar'
 import {
 	DefaultContextMenu,
 	TLUiContextMenuProps,
@@ -57,6 +58,7 @@ export interface TLUiComponents {
 	TopPanel?: ComponentType | null
 	SharePanel?: ComponentType | null
 	CursorChatBubble?: ComponentType | null
+	CommandBar?: ComponentType | null
 }
 
 const TldrawUiComponentsContext = createContext<TLUiComponents | null>(null)
@@ -98,6 +100,7 @@ export function TldrawUiComponentsProvider({
 					SharePanel: showCollaborationUi ? DefaultSharePanel : null,
 					CursorChatBubble: showCollaborationUi ? CursorChatBubble : null,
 					TopPanel: showCollaborationUi ? DefaultTopPanel : null,
+					CommandBar: DefaultCommmandBar,
 					..._overrides,
 				}),
 				[_overrides, showCollaborationUi]
diff --git a/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts b/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts
index f51fe4e21..36656afab 100644
--- a/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts
@@ -1,7 +1,7 @@
 import { Editor, TLPointerEventInfo, preventDefault, useEditor, useValue } from '@tldraw/editor'
 import hotkeys from 'hotkeys-js'
 import { useEffect } from 'react'
-import { COMMAND_BAR_ID } from '../components/CommandBar/CommandBar'
+import { COMMAND_BAR_ID } from '../components/CommandBar/DefaultCommandBar'
 import { useActions } from '../context/actions'
 import { useReadonly } from './useReadonly'
 import { useTools } from './useTools'
-- 
2.52.0


From 0f5cfdb93a1707a776e0968e57468a21e70a44dd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 13:37:23 +0200
Subject: [PATCH 06/28] Localize.

---
 assets/translations/main.json                                  | 1 +
 packages/tldraw/api-report.md                                  | 2 +-
 .../src/lib/ui/components/CommandBar/DefaultCommandBar.tsx     | 3 ++-
 .../src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts      | 1 +
 .../src/lib/ui/hooks/useTranslation/defaultTranslation.ts      | 1 +
 5 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/assets/translations/main.json b/assets/translations/main.json
index 771a50334..a67c2e606 100644
--- a/assets/translations/main.json
+++ b/assets/translations/main.json
@@ -137,6 +137,7 @@
 	"color-style.red": "Red",
 	"color-style.violet": "Violet",
 	"color-style.yellow": "Yellow",
+	"command-bar.placeholder": "Search...",
 	"fill-style.none": "None",
 	"document.default-name": "Untitled",
 	"fill-style.semi": "Semi",
diff --git a/packages/tldraw/api-report.md b/packages/tldraw/api-report.md
index 64ea3dbab..787c50979 100644
--- a/packages/tldraw/api-report.md
+++ b/packages/tldraw/api-report.md
@@ -3114,7 +3114,7 @@ export interface TLUiTranslation {
 export type TLUiTranslationContextType = TLUiTranslation;
 
 // @public (undocumented)
-export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark' | 'action.convert-to-embed' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link' | 'action.exit-pen-mode' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
+export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark' | 'action.convert-to-embed' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link' | 'action.exit-pen-mode' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'command-bar.placeholder' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
 
 // @public (undocumented)
 export interface TLUiTranslationProviderProps {
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index b5ae7dd23..c6c0913c4 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -13,6 +13,7 @@ export const COMMAND_BAR_ID = 'command bar'
 
 export function DefaultCommmandBar() {
 	const editor = useEditor()
+	const msg = useTranslation()
 	const [isOpen] = useMenuIsOpen(COMMAND_BAR_ID)
 	const [selected, setSelected] = useState(-1)
 	const [search, setSearch] = useState('')
@@ -71,7 +72,7 @@ export function DefaultCommmandBar() {
 							autoFocus
 							type="text"
 							value={search}
-							placeholder="Search..."
+							placeholder={msg('command-bar.placeholder')}
 							className="tlui-command-bar__input"
 							onChange={(e) => {
 								const value = e.target.value
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
index 818a31437..2d500a1d5 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
@@ -141,6 +141,7 @@ export type TLUiTranslationKey =
 	| 'color-style.red'
 	| 'color-style.violet'
 	| 'color-style.yellow'
+	| 'command-bar.placeholder'
 	| 'fill-style.none'
 	| 'document.default-name'
 	| 'fill-style.semi'
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
index 49d16e6fa..d8b027a17 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
@@ -142,6 +142,7 @@ export const DEFAULT_TRANSLATION = {
 	'color-style.red': 'Red',
 	'color-style.violet': 'Violet',
 	'color-style.yellow': 'Yellow',
+	'command-bar.placeholder': 'Search...',
 	'fill-style.none': 'None',
 	'document.default-name': 'Untitled',
 	'fill-style.semi': 'Semi',
-- 
2.52.0


From 15f24f6e7bf0439eb1129d86c7a16a35ead1b2de Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 13:50:56 +0200
Subject: [PATCH 07/28] Refactor.

---
 .../CommandBar/DefaultCommandBar.tsx          | 41 ++++++++++++-------
 .../src/lib/ui/hooks/useCommandBarActions.ts  |  5 ++-
 2 files changed, 30 insertions(+), 16 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index c6c0913c4..15b3557dc 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -10,6 +10,16 @@ import { TldrawUiButtonLabel } from '../primitives/Button/TldrawUiButtonLabel'
 import { TldrawUiKbd } from '../primitives/TldrawUiKbd'
 
 export const COMMAND_BAR_ID = 'command bar'
+const MAX_ITEMS = 6
+
+function getNext(current: number, max: number) {
+	const next = current - 1
+	return next < 0 ? max - 1 : next
+}
+
+function getPrevious(current: number, max: number) {
+	return (current + 1) % max
+}
 
 export function DefaultCommmandBar() {
 	const editor = useEditor()
@@ -18,47 +28,48 @@ export function DefaultCommmandBar() {
 	const [selected, setSelected] = useState(-1)
 	const [search, setSearch] = useState('')
 	const actions = useCommandBarActions(search)
+	const numItems = Math.min(actions.length, MAX_ITEMS)
+
+	const close = useCallback(() => {
+		setSelected(-1)
+		setSearch('')
+		editor.deleteOpenMenu(COMMAND_BAR_ID)
+	}, [editor])
 
 	const handleKeyDown = useCallback(
 		(e: React.KeyboardEvent) => {
 			switch (e.key) {
 				case 'Escape':
-					editor.deleteOpenMenu(COMMAND_BAR_ID)
+					close()
 					break
 				case 'Tab':
 					if (e.shiftKey) {
 						e.preventDefault()
-						const next = selected - 1
-						setSelected(next < 0 ? actions.length - 1 : next)
+						setSelected(getNext(selected, numItems))
 					} else {
 						e.preventDefault()
-						setSelected((selected + 1) % actions.length)
+						setSelected(getPrevious(selected, numItems))
 					}
 					break
 				case 'ArrowUp':
-					{
-						e.preventDefault()
-						const next = selected - 1
-						setSelected(next < 0 ? actions.length - 1 : next)
-					}
+					e.preventDefault()
+					setSelected(getNext(selected, numItems))
 					break
 				case 'ArrowDown':
 					e.preventDefault()
-					setSelected((selected + 1) % actions.length)
+					setSelected(getPrevious(selected, numItems))
 					break
 
 				case 'Enter': {
 					const action = actions[selected]
 					if (!action || !action.enabled?.()) return
-					setSearch('')
-					setSelected(-1)
-					editor.deleteOpenMenu(COMMAND_BAR_ID)
+					close()
 					action.onSelect('command-bar')
 					break
 				}
 			}
 		},
-		[editor, actions, selected]
+		[close, selected, numItems, actions]
 	)
 
 	if (!isOpen) return null
@@ -99,7 +110,7 @@ function CommandBarItems({
 }) {
 	return (
 		<div>
-			{actions.slice(0, 6).map((action, index) => {
+			{actions.slice(0, MAX_ITEMS).map((action, index) => {
 				return <CommandBarItem key={action.id} action={action} index={index} selected={selected} />
 			})}
 		</div>
diff --git a/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts b/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
index 6c6432259..9d68df428 100644
--- a/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
@@ -8,12 +8,15 @@ export function useCommandBarActions(search: string) {
 	const msg = useTranslation()
 	return Object.values(actions)
 		.filter((action) => {
+			// Don't show actions until we start searching
+			if (search === '') return false
 			// If we didn't want to show the disabled actions
 			// if (!action.enabled?.()) return false
 			const unwrapped = unwrapLabel(action.label, 'default')
 			const value = msg(unwrapped as TLUiTranslationKey)
 			if (!value) return false
-			if (search === '') return true
+			// Alternative to the search check above we can show all actions if we haven't started typing yet
+			// if (search === '') return true
 			return value.toLowerCase().includes(search.toLowerCase())
 		})
 		.sort((a, b) => {
-- 
2.52.0


From afb56293d43ed16aca4a253b12d03ab6df8b621f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 13:54:58 +0200
Subject: [PATCH 08/28] Fix colors.

---
 packages/tldraw/src/lib/ui.css                            | 1 +
 .../lib/ui/components/CommandBar/DefaultCommandBar.tsx    | 8 ++------
 2 files changed, 3 insertions(+), 6 deletions(-)

diff --git a/packages/tldraw/src/lib/ui.css b/packages/tldraw/src/lib/ui.css
index cf08cd367..b59fb1a5c 100644
--- a/packages/tldraw/src/lib/ui.css
+++ b/packages/tldraw/src/lib/ui.css
@@ -1830,6 +1830,7 @@
 }
 
 .tlui-command-bar__item-disabled-description {
+	color: var(--color-text-3);
 	font-size: 10px;
 	padding: var(--space-2);
 }
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 15b3557dc..1a7ffb228 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -21,6 +21,7 @@ function getPrevious(current: number, max: number) {
 	return (current + 1) % max
 }
 
+/** @public @react */
 export function DefaultCommmandBar() {
 	const editor = useEditor()
 	const msg = useTranslation()
@@ -135,12 +136,7 @@ function CommandBarItem({
 	const labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined
 
 	return (
-		<div
-			className="tlui-command-bar__item-wrapper"
-			style={{
-				color: enabled ? 'var(--color-text-1)' : '#aaa',
-			}}
-		>
+		<div className="tlui-command-bar__item-wrapper">
 			<div
 				className="tlui-command-bar__item"
 				style={{
-- 
2.52.0


From 84fafb5ca4f3cb3355b30af2e2f99e97f2e76f53 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:05:03 +0200
Subject: [PATCH 09/28] Use command bar specific labels for exports.

---
 assets/translations/main.json                                  | 3 +++
 packages/tldraw/api-report.md                                  | 2 +-
 .../src/lib/ui/components/CommandBar/DefaultCommandBar.tsx     | 2 +-
 packages/tldraw/src/lib/ui/context/actions.tsx                 | 3 +++
 packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts       | 2 +-
 .../src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts      | 3 +++
 .../src/lib/ui/hooks/useTranslation/defaultTranslation.ts      | 3 +++
 7 files changed, 15 insertions(+), 3 deletions(-)

diff --git a/assets/translations/main.json b/assets/translations/main.json
index a67c2e606..64722f425 100644
--- a/assets/translations/main.json
+++ b/assets/translations/main.json
@@ -37,10 +37,13 @@
 	"action.export-as-svg.short": "SVG",
 	"action.export-as-svg": "Export as SVG",
 	"action.export-all-as-json.short": "JSON",
+	"action.export-all-as-json.long": "Export all as JSON",
 	"action.export-all-as-json": "Export as JSON",
 	"action.export-all-as-png.short": "PNG",
+	"action.export-all-as-png.long": "Export all as PNG",
 	"action.export-all-as-png": "Export as PNG",
 	"action.export-all-as-svg.short": "SVG",
+	"action.export-all-as-svg.long": "Export all as SVG",
 	"action.export-all-as-svg": "Export as SVG",
 	"action.fit-frame-to-content": "Fit to content",
 	"action.flip-horizontal": "Flip horizontally",
diff --git a/packages/tldraw/api-report.md b/packages/tldraw/api-report.md
index 787c50979..873dc146f 100644
--- a/packages/tldraw/api-report.md
+++ b/packages/tldraw/api-report.md
@@ -3114,7 +3114,7 @@ export interface TLUiTranslation {
 export type TLUiTranslationContextType = TLUiTranslation;
 
 // @public (undocumented)
-export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark' | 'action.convert-to-embed' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link' | 'action.exit-pen-mode' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'command-bar.placeholder' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
+export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark' | 'action.convert-to-embed' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link' | 'action.exit-pen-mode' | 'action.export-all-as-json.long' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.long' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.long' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'command-bar.placeholder' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
 
 // @public (undocumented)
 export interface TLUiTranslationProviderProps {
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 1a7ffb228..89df1ff56 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -131,7 +131,7 @@ function CommandBarItem({
 	const { label, kbd } = action
 	const enabled = action.enabled?.()
 
-	const labelToUse = unwrapLabel(label, 'default')
+	const labelToUse = unwrapLabel(label, 'command-bar')
 
 	const labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined
 
diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index fa52bfc64..dcee2797f 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -299,6 +299,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					default: 'action.export-all-as-svg',
 					menu: 'action.export-all-as-svg.short',
 					['context-menu']: 'action.export-all-as-svg.short',
+					'command-bar': 'action.export-all-as-svg.long',
 				},
 				readonlyOk: true,
 				onSelect(source) {
@@ -322,6 +323,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					default: 'action.export-all-as-png',
 					menu: 'action.export-all-as-png.short',
 					['context-menu']: 'action.export-all-as-png.short',
+					'command-bar': 'action.export-all-as-png.long',
 				},
 				readonlyOk: true,
 				onSelect(source) {
@@ -340,6 +342,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					default: 'action.export-all-as-json',
 					menu: 'action.export-all-as-json.short',
 					['context-menu']: 'action.export-all-as-json.short',
+					'command-bar': 'action.export-all-as-json.long',
 				},
 				readonlyOk: true,
 				onSelect(source) {
diff --git a/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts b/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
index 9d68df428..74815c52f 100644
--- a/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useCommandBarActions.ts
@@ -12,7 +12,7 @@ export function useCommandBarActions(search: string) {
 			if (search === '') return false
 			// If we didn't want to show the disabled actions
 			// if (!action.enabled?.()) return false
-			const unwrapped = unwrapLabel(action.label, 'default')
+			const unwrapped = unwrapLabel(action.label, 'command-bar')
 			const value = msg(unwrapped as TLUiTranslationKey)
 			if (!value) return false
 			// Alternative to the search check above we can show all actions if we haven't started typing yet
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
index 2d500a1d5..68b8cd237 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
@@ -41,10 +41,13 @@ export type TLUiTranslationKey =
 	| 'action.export-as-svg.short'
 	| 'action.export-as-svg'
 	| 'action.export-all-as-json.short'
+	| 'action.export-all-as-json.long'
 	| 'action.export-all-as-json'
 	| 'action.export-all-as-png.short'
+	| 'action.export-all-as-png.long'
 	| 'action.export-all-as-png'
 	| 'action.export-all-as-svg.short'
+	| 'action.export-all-as-svg.long'
 	| 'action.export-all-as-svg'
 	| 'action.fit-frame-to-content'
 	| 'action.flip-horizontal'
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
index d8b027a17..59f798189 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
@@ -41,10 +41,13 @@ export const DEFAULT_TRANSLATION = {
 	'action.export-as-svg.short': 'SVG',
 	'action.export-as-svg': 'Export as SVG',
 	'action.export-all-as-json.short': 'JSON',
+	'action.export-all-as-json.long': 'Export all as JSON',
 	'action.export-all-as-json': 'Export as JSON',
 	'action.export-all-as-png.short': 'PNG',
+	'action.export-all-as-png.long': 'Export all as PNG',
 	'action.export-all-as-png': 'Export as PNG',
 	'action.export-all-as-svg.short': 'SVG',
+	'action.export-all-as-svg.long': 'Export all as SVG',
 	'action.export-all-as-svg': 'Export as SVG',
 	'action.fit-frame-to-content': 'Fit to content',
 	'action.flip-horizontal': 'Flip horizontally',
-- 
2.52.0


From 295bef05d9e2207354746555d751fa3d8f26c254 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:09:37 +0200
Subject: [PATCH 10/28] Make clicking work.

---
 .../CommandBar/DefaultCommandBar.tsx          | 34 ++++++++++++++-----
 1 file changed, 26 insertions(+), 8 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 89df1ff56..b499f9ff2 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -37,6 +37,13 @@ export function DefaultCommmandBar() {
 		editor.deleteOpenMenu(COMMAND_BAR_ID)
 	}, [editor])
 
+	const onSelect = useCallback(() => {
+		const action = actions[selected]
+		if (!action || !action.enabled?.()) return
+		close()
+		action.onSelect('command-bar')
+	}, [actions, close, selected])
+
 	const handleKeyDown = useCallback(
 		(e: React.KeyboardEvent) => {
 			switch (e.key) {
@@ -62,15 +69,12 @@ export function DefaultCommmandBar() {
 					break
 
 				case 'Enter': {
-					const action = actions[selected]
-					if (!action || !action.enabled?.()) return
-					close()
-					action.onSelect('command-bar')
+					onSelect()
 					break
 				}
 			}
 		},
-		[close, selected, numItems, actions]
+		[close, selected, numItems, onSelect]
 	)
 
 	if (!isOpen) return null
@@ -95,7 +99,9 @@ export function DefaultCommmandBar() {
 								if (value === '') setSelected(-1)
 							}}
 						/>
-						{actions.length !== 0 && <CommandBarItems actions={actions} selected={selected} />}
+						{actions.length !== 0 && (
+							<CommandBarItems actions={actions} selected={selected} onSelect={onSelect} />
+						)}
 					</div>
 				</div>
 			</div>
@@ -105,14 +111,24 @@ export function DefaultCommmandBar() {
 function CommandBarItems({
 	actions,
 	selected,
+	onSelect,
 }: {
 	actions: TLUiActionItem<string, string>[]
 	selected: number
+	onSelect: () => void
 }) {
 	return (
 		<div>
 			{actions.slice(0, MAX_ITEMS).map((action, index) => {
-				return <CommandBarItem key={action.id} action={action} index={index} selected={selected} />
+				return (
+					<CommandBarItem
+						key={action.id}
+						action={action}
+						index={index}
+						selected={selected}
+						onSelect={onSelect}
+					/>
+				)
 			})}
 		</div>
 	)
@@ -122,10 +138,12 @@ function CommandBarItem({
 	action,
 	index,
 	selected,
+	onSelect,
 }: {
 	action: TLUiActionItem<string, string>
 	index: number
 	selected: number
+	onSelect: () => void
 }) {
 	const msg = useTranslation()
 	const { label, kbd } = action
@@ -143,7 +161,7 @@ function CommandBarItem({
 					background: index === selected ? 'var(--color-hint)' : 'var(--color-background)',
 				}}
 			>
-				<TldrawUiButton type="menu" disabled={!enabled}>
+				<TldrawUiButton type="menu" disabled={!enabled} onClick={onSelect}>
 					<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>
 					{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}
 				</TldrawUiButton>
-- 
2.52.0


From db7233d20a4d8f6bec12ee7f53e13162f8cb968a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:12:03 +0200
Subject: [PATCH 11/28] Fix clicking.

---
 .../CommandBar/DefaultCommandBar.tsx          | 23 +++++++++++--------
 1 file changed, 13 insertions(+), 10 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index b499f9ff2..17dc6b3df 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -37,12 +37,15 @@ export function DefaultCommmandBar() {
 		editor.deleteOpenMenu(COMMAND_BAR_ID)
 	}, [editor])
 
-	const onSelect = useCallback(() => {
-		const action = actions[selected]
-		if (!action || !action.enabled?.()) return
-		close()
-		action.onSelect('command-bar')
-	}, [actions, close, selected])
+	const onSelect = useCallback(
+		(index: number) => {
+			const action = actions[index]
+			if (!action || !action.enabled?.()) return
+			close()
+			action.onSelect('command-bar')
+		},
+		[actions, close, selected]
+	)
 
 	const handleKeyDown = useCallback(
 		(e: React.KeyboardEvent) => {
@@ -69,7 +72,7 @@ export function DefaultCommmandBar() {
 					break
 
 				case 'Enter': {
-					onSelect()
+					onSelect(selected)
 					break
 				}
 			}
@@ -115,7 +118,7 @@ function CommandBarItems({
 }: {
 	actions: TLUiActionItem<string, string>[]
 	selected: number
-	onSelect: () => void
+	onSelect: (index: number) => void
 }) {
 	return (
 		<div>
@@ -143,7 +146,7 @@ function CommandBarItem({
 	action: TLUiActionItem<string, string>
 	index: number
 	selected: number
-	onSelect: () => void
+	onSelect: (index: number) => void
 }) {
 	const msg = useTranslation()
 	const { label, kbd } = action
@@ -161,7 +164,7 @@ function CommandBarItem({
 					background: index === selected ? 'var(--color-hint)' : 'var(--color-background)',
 				}}
 			>
-				<TldrawUiButton type="menu" disabled={!enabled} onClick={onSelect}>
+				<TldrawUiButton type="menu" disabled={!enabled} onClick={() => onSelect(index)}>
 					<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>
 					{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}
 				</TldrawUiButton>
-- 
2.52.0


From c9f0dd59f9b34fb98a51d784ca71796159e436b8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:13:13 +0200
Subject: [PATCH 12/28] Fix signature.

---
 .../src/lib/ui/components/CommandBar/DefaultCommandBar.tsx    | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 17dc6b3df..8c9d19885 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -118,7 +118,7 @@ function CommandBarItems({
 }: {
 	actions: TLUiActionItem<string, string>[]
 	selected: number
-	onSelect: (index: number) => void
+	onSelect(index: number): void
 }) {
 	return (
 		<div>
@@ -146,7 +146,7 @@ function CommandBarItem({
 	action: TLUiActionItem<string, string>
 	index: number
 	selected: number
-	onSelect: (index: number) => void
+	onSelect(index: number): void
 }) {
 	const msg = useTranslation()
 	const { label, kbd } = action
-- 
2.52.0


From c31b736e9fd7521cf39b65178f39222676c96fb1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:13:37 +0200
Subject: [PATCH 13/28] Remove not needed dep.

---
 .../src/lib/ui/components/CommandBar/DefaultCommandBar.tsx      | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 8c9d19885..b495282ff 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -44,7 +44,7 @@ export function DefaultCommmandBar() {
 			close()
 			action.onSelect('command-bar')
 		},
-		[actions, close, selected]
+		[actions, close]
 	)
 
 	const handleKeyDown = useCallback(
-- 
2.52.0


From ba6c0b38a0c31f42170b0e54aa42a18a2c1c4100 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:22:19 +0200
Subject: [PATCH 14/28] Add a more clear description for the command bar.

---
 assets/translations/main.json                                | 1 +
 packages/tldraw/api-report.md                                | 2 +-
 packages/tldraw/src/lib/ui/context/actions.tsx               | 5 ++++-
 .../src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts    | 1 +
 .../src/lib/ui/hooks/useTranslation/defaultTranslation.ts    | 1 +
 5 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/assets/translations/main.json b/assets/translations/main.json
index 64722f425..d965fc656 100644
--- a/assets/translations/main.json
+++ b/assets/translations/main.json
@@ -140,6 +140,7 @@
 	"color-style.red": "Red",
 	"color-style.violet": "Violet",
 	"color-style.yellow": "Yellow",
+	"command-bar.move-to-new-page": "Move to new page",
 	"command-bar.placeholder": "Search...",
 	"fill-style.none": "None",
 	"document.default-name": "Untitled",
diff --git a/packages/tldraw/api-report.md b/packages/tldraw/api-report.md
index 873dc146f..883fff035 100644
--- a/packages/tldraw/api-report.md
+++ b/packages/tldraw/api-report.md
@@ -3114,7 +3114,7 @@ export interface TLUiTranslation {
 export type TLUiTranslationContextType = TLUiTranslation;
 
 // @public (undocumented)
-export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark' | 'action.convert-to-embed' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link' | 'action.exit-pen-mode' | 'action.export-all-as-json.long' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.long' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.long' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'command-bar.placeholder' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
+export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark' | 'action.convert-to-embed' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link' | 'action.exit-pen-mode' | 'action.export-all-as-json.long' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.long' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.long' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'command-bar.move-to-new-page' | 'command-bar.placeholder' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
 
 // @public (undocumented)
 export interface TLUiTranslationProviderProps {
diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index dcee2797f..cbf22dee2 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -1638,7 +1638,10 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 			},
 			{
 				id: 'move-to-new-page',
-				label: 'context.pages.new-page',
+				label: {
+					default: 'context.pages.new-page',
+					'command-bar': 'command-bar.move-to-new-page',
+				},
 				onSelect(source) {
 					const newPageId = PageRecordType.createId()
 					const ids = editor.getSelectedShapeIds()
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
index 68b8cd237..4dd33611c 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
@@ -144,6 +144,7 @@ export type TLUiTranslationKey =
 	| 'color-style.red'
 	| 'color-style.violet'
 	| 'color-style.yellow'
+	| 'command-bar.move-to-new-page'
 	| 'command-bar.placeholder'
 	| 'fill-style.none'
 	| 'document.default-name'
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
index 59f798189..c3dea826d 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
@@ -145,6 +145,7 @@ export const DEFAULT_TRANSLATION = {
 	'color-style.red': 'Red',
 	'color-style.violet': 'Violet',
 	'color-style.yellow': 'Yellow',
+	'command-bar.move-to-new-page': 'Move to new page',
 	'command-bar.placeholder': 'Search...',
 	'fill-style.none': 'None',
 	'document.default-name': 'Untitled',
-- 
2.52.0


From 7af9c42809c3b501a11e9cd9331d59b46297cdcd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:24:23 +0200
Subject: [PATCH 15/28] No need for div.

---
 .../src/lib/ui/components/CommandBar/DefaultCommandBar.tsx   | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index b495282ff..17feff8c7 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -70,7 +70,6 @@ export function DefaultCommmandBar() {
 					e.preventDefault()
 					setSelected(getPrevious(selected, numItems))
 					break
-
 				case 'Enter': {
 					onSelect(selected)
 					break
@@ -121,7 +120,7 @@ function CommandBarItems({
 	onSelect(index: number): void
 }) {
 	return (
-		<div>
+		<>
 			{actions.slice(0, MAX_ITEMS).map((action, index) => {
 				return (
 					<CommandBarItem
@@ -133,7 +132,7 @@ function CommandBarItems({
 					/>
 				)
 			})}
-		</div>
+		</>
 	)
 }
 
-- 
2.52.0


From 01a7fa2b17bacd668c84f3cf52f38f79780fe23a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 28 Aug 2024 14:27:45 +0200
Subject: [PATCH 16/28] Use clases for selected state.

---
 packages/tldraw/src/lib/ui.css                       |  4 ++++
 .../ui/components/CommandBar/DefaultCommandBar.tsx   | 12 +++++++-----
 2 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/packages/tldraw/src/lib/ui.css b/packages/tldraw/src/lib/ui.css
index b59fb1a5c..609e2d92a 100644
--- a/packages/tldraw/src/lib/ui.css
+++ b/packages/tldraw/src/lib/ui.css
@@ -1829,6 +1829,10 @@
 	align-items: center;
 }
 
+.tlui-command-bar__item-selected {
+	background: var(--color-hint);
+}
+
 .tlui-command-bar__item-disabled-description {
 	color: var(--color-text-3);
 	font-size: 10px;
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 17feff8c7..e23666f74 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -1,4 +1,5 @@
 import { useEditor } from '@tldraw/editor'
+import classNames from 'classnames'
 import { useCallback, useState } from 'react'
 import { TLUiActionItem, unwrapLabel } from '../../context/actions'
 import { useCommandBarActions } from '../../hooks/useCommandBarActions'
@@ -154,21 +155,22 @@ function CommandBarItem({
 	const labelToUse = unwrapLabel(label, 'command-bar')
 
 	const labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined
+	const isSelected = selected === index
+	const showDisabledDescription = isSelected && !enabled && action.disabledDescription
 
 	return (
 		<div className="tlui-command-bar__item-wrapper">
 			<div
-				className="tlui-command-bar__item"
-				style={{
-					background: index === selected ? 'var(--color-hint)' : 'var(--color-background)',
-				}}
+				className={classNames('tlui-command-bar__item', {
+					'tlui-command-bar__item-selected': isSelected,
+				})}
 			>
 				<TldrawUiButton type="menu" disabled={!enabled} onClick={() => onSelect(index)}>
 					<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>
 					{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}
 				</TldrawUiButton>
 			</div>
-			{selected === index && !enabled && action.disabledDescription && (
+			{showDisabledDescription && (
 				<span className="tlui-command-bar__item-disabled-description">
 					{action.disabledDescription}
 				</span>
-- 
2.52.0


From 640ea46fbdb7017aaa1bcb12cf436b3055751fcd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Thu, 29 Aug 2024 09:42:31 +0200
Subject: [PATCH 17/28] Fix an issue with embed dialog not opening.

Enter was triggering on click in the dialogs component.
---
 .../src/lib/ui/components/CommandBar/DefaultCommandBar.tsx       | 1 +
 1 file changed, 1 insertion(+)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index e23666f74..4ca4e7a8e 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -72,6 +72,7 @@ export function DefaultCommmandBar() {
 					setSelected(getPrevious(selected, numItems))
 					break
 				case 'Enter': {
+					e.preventDefault()
 					onSelect(selected)
 					break
 				}
-- 
2.52.0


From 9b2f9309d3395c131efffd83f0f671bf4546b336 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Thu, 29 Aug 2024 14:21:43 +0200
Subject: [PATCH 18/28] Allow users to pick previously selected actions by
 using tab or arrow keys.

---
 .../CommandBar/DefaultCommandBar.tsx          | 52 ++++++++++++++++---
 1 file changed, 44 insertions(+), 8 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 4ca4e7a8e..229a577ca 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -1,7 +1,7 @@
 import { useEditor } from '@tldraw/editor'
 import classNames from 'classnames'
 import { useCallback, useState } from 'react'
-import { TLUiActionItem, unwrapLabel } from '../../context/actions'
+import { TLUiActionItem, unwrapLabel, useActions } from '../../context/actions'
 import { useCommandBarActions } from '../../hooks/useCommandBarActions'
 import { useMenuIsOpen } from '../../hooks/useMenuIsOpen'
 import { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'
@@ -29,23 +29,35 @@ export function DefaultCommmandBar() {
 	const [isOpen] = useMenuIsOpen(COMMAND_BAR_ID)
 	const [selected, setSelected] = useState(-1)
 	const [search, setSearch] = useState('')
-	const actions = useCommandBarActions(search)
+	const [previousActions, setPreviousActions] = useState<string[]>([])
+	const [showPreviousActions, setShowPreviousActions] = useState(false)
+	let actions = useCommandBarActions(search)
+	const allActions = useActions()
+	if (showPreviousActions) {
+		actions = previousActions.map((id) => allActions[id])
+	}
 	const numItems = Math.min(actions.length, MAX_ITEMS)
 
 	const close = useCallback(() => {
 		setSelected(-1)
 		setSearch('')
+		setShowPreviousActions(false)
 		editor.deleteOpenMenu(COMMAND_BAR_ID)
 	}, [editor])
 
+	const shouldShowPreviousActions =
+		!showPreviousActions && search === '' && previousActions.length > 0
+
 	const onSelect = useCallback(
 		(index: number) => {
 			const action = actions[index]
 			if (!action || !action.enabled?.()) return
 			close()
 			action.onSelect('command-bar')
+			const newActions = [action.id, ...previousActions.filter((a) => a !== action.id)]
+			setPreviousActions(newActions)
 		},
-		[actions, close]
+		[actions, close, previousActions]
 	)
 
 	const handleKeyDown = useCallback(
@@ -57,28 +69,52 @@ export function DefaultCommmandBar() {
 				case 'Tab':
 					if (e.shiftKey) {
 						e.preventDefault()
-						setSelected(getNext(selected, numItems))
+						if (shouldShowPreviousActions) {
+							setShowPreviousActions(true)
+							setSelected(0)
+						} else {
+							setSelected(getNext(selected, numItems))
+						}
 					} else {
 						e.preventDefault()
-						setSelected(getPrevious(selected, numItems))
+						if (shouldShowPreviousActions) {
+							setShowPreviousActions(true)
+							setSelected(previousActions.length - 1)
+						} else {
+							setSelected(getPrevious(selected, numItems))
+						}
 					}
 					break
 				case 'ArrowUp':
 					e.preventDefault()
-					setSelected(getNext(selected, numItems))
+					if (shouldShowPreviousActions) {
+						setShowPreviousActions(true)
+						setSelected(previousActions.length - 1)
+					} else {
+						setSelected(getNext(selected, numItems))
+					}
 					break
 				case 'ArrowDown':
 					e.preventDefault()
-					setSelected(getPrevious(selected, numItems))
+					if (shouldShowPreviousActions) {
+						setShowPreviousActions(true)
+						setSelected(0)
+					} else {
+						setSelected(getPrevious(selected, numItems))
+					}
 					break
 				case 'Enter': {
 					e.preventDefault()
 					onSelect(selected)
 					break
 				}
+				default:
+					setShowPreviousActions(false)
+					setSelected(0)
+					break
 			}
 		},
-		[close, selected, numItems, onSelect]
+		[close, shouldShowPreviousActions, selected, numItems, previousActions.length, onSelect]
 	)
 
 	if (!isOpen) return null
-- 
2.52.0


From a6ee581900903531068548c7f1502365639d5228 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Thu, 29 Aug 2024 14:32:19 +0200
Subject: [PATCH 19/28] Refactor.

---
 .../CommandBar/DefaultCommandBar.tsx          | 40 +++++++++++--------
 1 file changed, 23 insertions(+), 17 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 229a577ca..0fd065ab4 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -29,12 +29,13 @@ export function DefaultCommmandBar() {
 	const [isOpen] = useMenuIsOpen(COMMAND_BAR_ID)
 	const [selected, setSelected] = useState(-1)
 	const [search, setSearch] = useState('')
-	const [previousActions, setPreviousActions] = useState<string[]>([])
+	const [previousActionIds, setPreviousActionIds] = useState<string[]>([])
 	const [showPreviousActions, setShowPreviousActions] = useState(false)
 	let actions = useCommandBarActions(search)
 	const allActions = useActions()
+
 	if (showPreviousActions) {
-		actions = previousActions.map((id) => allActions[id])
+		actions = previousActionIds.map((id) => allActions[id])
 	}
 	const numItems = Math.min(actions.length, MAX_ITEMS)
 
@@ -46,7 +47,7 @@ export function DefaultCommmandBar() {
 	}, [editor])
 
 	const shouldShowPreviousActions =
-		!showPreviousActions && search === '' && previousActions.length > 0
+		!showPreviousActions && search === '' && previousActionIds.length > 0
 
 	const onSelect = useCallback(
 		(index: number) => {
@@ -54,10 +55,10 @@ export function DefaultCommmandBar() {
 			if (!action || !action.enabled?.()) return
 			close()
 			action.onSelect('command-bar')
-			const newActions = [action.id, ...previousActions.filter((a) => a !== action.id)]
-			setPreviousActions(newActions)
+			const newActions = [action.id, ...previousActionIds.filter((a) => a !== action.id)]
+			setPreviousActionIds(newActions)
 		},
-		[actions, close, previousActions]
+		[actions, close, previousActionIds]
 	)
 
 	const handleKeyDown = useCallback(
@@ -79,7 +80,7 @@ export function DefaultCommmandBar() {
 						e.preventDefault()
 						if (shouldShowPreviousActions) {
 							setShowPreviousActions(true)
-							setSelected(previousActions.length - 1)
+							setSelected(previousActionIds.length - 1)
 						} else {
 							setSelected(getPrevious(selected, numItems))
 						}
@@ -89,7 +90,7 @@ export function DefaultCommmandBar() {
 					e.preventDefault()
 					if (shouldShowPreviousActions) {
 						setShowPreviousActions(true)
-						setSelected(previousActions.length - 1)
+						setSelected(previousActionIds.length - 1)
 					} else {
 						setSelected(getNext(selected, numItems))
 					}
@@ -114,7 +115,19 @@ export function DefaultCommmandBar() {
 					break
 			}
 		},
-		[close, shouldShowPreviousActions, selected, numItems, previousActions.length, onSelect]
+		[close, shouldShowPreviousActions, selected, numItems, previousActionIds.length, onSelect]
+	)
+
+	const handleChange = useCallback(
+		(e: React.ChangeEvent<HTMLInputElement>) => {
+			const value = e.target.value
+			setSearch(value)
+			if (selected === -1) {
+				setSelected(0)
+			}
+			if (value === '') setSelected(-1)
+		},
+		[selected]
 	)
 
 	if (!isOpen) return null
@@ -130,14 +143,7 @@ export function DefaultCommmandBar() {
 							value={search}
 							placeholder={msg('command-bar.placeholder')}
 							className="tlui-command-bar__input"
-							onChange={(e) => {
-								const value = e.target.value
-								setSearch(value)
-								if (selected === -1) {
-									setSelected(0)
-								}
-								if (value === '') setSelected(-1)
-							}}
+							onChange={handleChange}
 						/>
 						{actions.length !== 0 && (
 							<CommandBarItems actions={actions} selected={selected} onSelect={onSelect} />
-- 
2.52.0


From c0d7e80fb34b4b24e04ea02c2e6e88f92e8e54e0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Thu, 5 Sep 2024 14:05:27 +0200
Subject: [PATCH 20/28] Use ellipsis.

---
 assets/translations/main.json                                   | 2 +-
 .../src/lib/ui/hooks/useTranslation/defaultTranslation.ts       | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/assets/translations/main.json b/assets/translations/main.json
index d965fc656..412e484a0 100644
--- a/assets/translations/main.json
+++ b/assets/translations/main.json
@@ -141,7 +141,7 @@
 	"color-style.violet": "Violet",
 	"color-style.yellow": "Yellow",
 	"command-bar.move-to-new-page": "Move to new page",
-	"command-bar.placeholder": "Search...",
+	"command-bar.placeholder": "Search",
 	"fill-style.none": "None",
 	"document.default-name": "Untitled",
 	"fill-style.semi": "Semi",
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
index c3dea826d..aaada34f8 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
@@ -146,7 +146,7 @@ export const DEFAULT_TRANSLATION = {
 	'color-style.violet': 'Violet',
 	'color-style.yellow': 'Yellow',
 	'command-bar.move-to-new-page': 'Move to new page',
-	'command-bar.placeholder': 'Search...',
+	'command-bar.placeholder': 'Search',
 	'fill-style.none': 'None',
 	'document.default-name': 'Untitled',
 	'fill-style.semi': 'Semi',
-- 
2.52.0


From 1b15e29c1582a25c5062a8d821449c2c68c6bcde Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 11 Sep 2024 14:30:03 +0200
Subject: [PATCH 21/28] Use enabled from onSelect

---
 .../tldraw/src/lib/ui/context/actions.tsx     | 315 +++++++++---------
 1 file changed, 166 insertions(+), 149 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index cbf22dee2..76ceb83cb 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -102,6 +102,13 @@ function getExportName(editor: Editor, defaultName: string) {
 	return undefined
 }
 
+function getSelectedOrPageShapeIds(editor: Editor) {
+	let ids = editor.getSelectedShapeIds()
+	if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
+	if (ids.length === 0) return
+	return ids
+}
+
 /** @internal */
 export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 	const editor = useEditor()
@@ -175,15 +182,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.edit-link',
 				icon: 'link',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('edit-link', { source })
 					editor.markHistoryStoppingPoint('edit-link')
 					addDialog({ component: EditLinkDialog })
 				},
 				enabled() {
-					return editLinkEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && editLinkEnabled
 				},
 			},
 			{
@@ -216,6 +222,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'undo',
 				kbd: '$z',
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('undo', { source })
 					editor.undo()
 				},
@@ -229,6 +236,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'redo',
 				kbd: '$!z',
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('redo', { source })
 					editor.redo()
 				},
@@ -245,14 +253,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
-					let ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
+					if (!this.enabled()) return
+					const ids = getSelectedOrPageShapeIds(editor)!
 					trackEvent('export-as', { format: 'svg', source })
 					exportAs(ids, 'svg', getExportName(editor, defaultDocumentName))
 				},
 				enabled() {
-					return pageHasShapes
+					const ids = getSelectedOrPageShapeIds(editor)
+					return !!ids && pageHasShapes
 				},
 			},
 			{
@@ -264,14 +272,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
-					let ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
+					if (!this.enabled()) return
+					const ids = getSelectedOrPageShapeIds(editor)!
 					trackEvent('export-as', { format: 'png', source })
 					exportAs(ids, 'png', getExportName(editor, defaultDocumentName))
 				},
 				enabled() {
-					return pageHasShapes
+					const ids = getSelectedOrPageShapeIds(editor)!
+					return !!ids && pageHasShapes
 				},
 			},
 			{
@@ -283,14 +291,15 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
-					let ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
+					if (!this.enabled()) return
+					const ids = getSelectedOrPageShapeIds(editor)!
+
 					trackEvent('export-as', { format: 'json', source })
 					exportAs(ids, 'json', getExportName(editor, defaultDocumentName))
 				},
 				enabled() {
-					return pageHasShapes
+					const ids = getSelectedOrPageShapeIds(editor)!
+					return !!ids && pageHasShapes
 				},
 			},
 			{
@@ -303,9 +312,8 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
-					let ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
+					if (!this.enabled()) return
+
 					trackEvent('export-all-as', { format: 'svg', source })
 					exportAs(
 						Array.from(editor.getCurrentPageShapeIds()),
@@ -314,7 +322,8 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					)
 				},
 				enabled() {
-					return true
+					const ids = editor.getCurrentPageShapeIds()
+					return !!ids
 				},
 			},
 			{
@@ -327,13 +336,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					const ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
 					trackEvent('export-all-as', { format: 'png', source })
 					exportAs(ids, 'png', getExportName(editor, defaultDocumentName))
 				},
 				enabled() {
-					return true
+					const ids = editor.getCurrentPageShapeIds()
+					return ids.size > 0
 				},
 			},
 			{
@@ -346,13 +356,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					const ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
 					trackEvent('export-all-as', { format: 'json', source })
 					exportAs(ids, 'json', getExportName(editor, defaultDocumentName))
 				},
 				enabled() {
-					return true
+					const ids = editor.getCurrentPageShapeIds()
+					return ids.size > 0
 				},
 			},
 			{
@@ -365,14 +376,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '$!c',
 				readonlyOk: true,
 				onSelect(source) {
-					let ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
+					if (!this.enabled()) return
+					const ids = getSelectedOrPageShapeIds(editor)!
 					trackEvent('copy-as', { format: 'svg', source })
 					copyAs(ids, 'svg')
 				},
 				enabled() {
-					return true
+					const ids = getSelectedOrPageShapeIds(editor)
+					return !!ids
 				},
 			},
 			{
@@ -384,14 +395,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
-					let ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
+					if (!this.enabled()) return
+					const ids = getSelectedOrPageShapeIds(editor)!
 					trackEvent('copy-as', { format: 'png', source })
 					copyAs(ids, 'png')
 				},
 				enabled() {
-					return true
+					const ids = getSelectedOrPageShapeIds(editor)
+					return !!ids
 				},
 			},
 			{
@@ -403,22 +414,21 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				readonlyOk: true,
 				onSelect(source) {
-					let ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())
-					if (ids.length === 0) return
+					if (!this.enabled()) return
+					const ids = getSelectedOrPageShapeIds(editor)!
 					trackEvent('copy-as', { format: 'json', source })
 					copyAs(ids, 'json')
 				},
 				enabled() {
-					return true
+					const ids = getSelectedOrPageShapeIds(editor)
+					return !!ids
 				},
 			},
 			{
 				id: 'toggle-auto-size',
 				label: 'action.toggle-auto-size',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('toggle-auto-size', { source })
 					editor.markHistoryStoppingPoint('toggling auto size')
@@ -447,7 +457,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					)
 				},
 				enabled() {
-					return true
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst()
 				},
 			},
 			{
@@ -470,7 +480,6 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 
 					openWindow(shape.props.url, '_blank')
 				},
-				// does not seem to be used?
 				enabled() {
 					return true
 				},
@@ -480,7 +489,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				readonlyOk: true,
 				kbd: 'z',
 				onSelect(source) {
-					if (editor.root.getCurrent()?.id === 'zoom') return
+					if (!this.enabled()) return
 
 					trackEvent('zoom-tool', { source })
 					if (!(editor.inputs.shiftKey || editor.inputs.ctrlKey)) {
@@ -490,17 +499,15 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						}
 					}
 				},
-				// does not seem to be used?
 				enabled() {
-					return true
+					return editor.root.getCurrent()?.id !== 'zoom'
 				},
 			},
 			{
 				id: 'convert-to-bookmark',
 				label: 'action.convert-to-bookmark',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					editor.run(() => {
 						trackEvent('convert-to-bookmark', { source })
@@ -538,15 +545,16 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				enabled() {
-					return convertToBookmarkEnabled
+					return (
+						canApplySelectionAction() && !mustGoBackToSelectToolFirst() && convertToBookmarkEnabled
+					)
 				},
 			},
 			{
 				id: 'convert-to-embed',
 				label: 'action.convert-to-embed',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('convert-to-embed', { source })
 
@@ -596,7 +604,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				enabled() {
-					return convertToEmbedEnabled
+					return (
+						canApplySelectionAction() && !mustGoBackToSelectToolFirst() && convertToEmbedEnabled
+					)
 				},
 			},
 			{
@@ -605,8 +615,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.duplicate',
 				icon: 'duplicate',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('duplicate-shapes', { source })
 					const instanceState = editor.getInstanceState()
@@ -646,7 +655,11 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					}
 				},
 				enabled() {
-					return !!(oneSelected && isInSelectState)
+					return (
+						canApplySelectionAction() &&
+						!mustGoBackToSelectToolFirst() &&
+						!!(oneSelected && isInSelectState)
+					)
 				},
 			},
 			{
@@ -655,15 +668,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '$!g',
 				icon: 'ungroup',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('ungroup-shapes', { source })
 					editor.markHistoryStoppingPoint('ungroup')
 					editor.ungroupShapes(editor.getSelectedShapeIds())
 				},
 				enabled() {
-					return allowUngroup
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && allowUngroup
 				},
 			},
 			{
@@ -672,8 +684,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '$g',
 				icon: 'group',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('group-shapes', { source })
 					const onlySelectedShape = editor.getOnlySelectedShape()
@@ -686,7 +697,11 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					}
 				},
 				enabled() {
-					return !!(allowGroup && twoSelected && isInSelectState)
+					return (
+						canApplySelectionAction() &&
+						!mustGoBackToSelectToolFirst() &&
+						!!(allowGroup && twoSelected && isInSelectState)
+					)
 				},
 			},
 			{
@@ -694,7 +709,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.remove-frame',
 				kbd: '$!f',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
+					if (!this.enabled()) return
 
 					trackEvent('remove-frame', { source })
 					const selectedShapes = editor.getSelectedShapes()
@@ -710,14 +725,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					}
 				},
 				enabled() {
-					return removeFrameEnabled
+					return canApplySelectionAction() && removeFrameEnabled
 				},
 			},
 			{
 				id: 'fit-frame-to-content',
 				label: 'action.fit-frame-to-content',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
+					if (!this.enabled()) return
 
 					trackEvent('fit-frame-to-content', { source })
 					const onlySelectedShape = editor.getOnlySelectedShape()
@@ -727,7 +742,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					}
 				},
 				enabled() {
-					return fitFrameToContentEnabled
+					return canApplySelectionAction() && fitFrameToContentEnabled
 				},
 			},
 			{
@@ -736,8 +751,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '?A',
 				icon: 'align-left',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('align-shapes', { operation: 'left', source })
 					editor.markHistoryStoppingPoint('align left')
@@ -746,7 +760,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 				disabledDescription: 'You need to have at least two shapes selected',
 			},
@@ -759,8 +773,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '?H',
 				icon: 'align-center-horizontal',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('align-shapes', { operation: 'center-horizontal', source })
 					editor.markHistoryStoppingPoint('align center horizontal')
@@ -769,7 +782,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 			},
 			{
@@ -778,8 +791,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '?D',
 				icon: 'align-right',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('align-shapes', { operation: 'right', source })
 					editor.markHistoryStoppingPoint('align right')
@@ -788,7 +800,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 			},
 			{
@@ -800,8 +812,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '?V',
 				icon: 'align-center-vertical',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('align-shapes', { operation: 'center-vertical', source })
 					editor.markHistoryStoppingPoint('align center vertical')
@@ -810,7 +821,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 			},
 			{
@@ -819,8 +830,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'align-top',
 				kbd: '?W',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('align-shapes', { operation: 'top', source })
 					editor.markHistoryStoppingPoint('align top')
@@ -829,7 +839,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 			},
 			{
@@ -838,8 +848,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'align-bottom',
 				kbd: '?S',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('align-shapes', { operation: 'bottom', source })
 					editor.markHistoryStoppingPoint('align bottom')
@@ -848,7 +857,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 			},
 			{
@@ -860,8 +869,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'distribute-horizontal',
 				kbd: '?!h',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('distribute-shapes', { operation: 'horizontal', source })
 					editor.markHistoryStoppingPoint('distribute horizontal')
@@ -870,7 +878,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return distributeEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && distributeEnabled
 				},
 			},
 			{
@@ -882,8 +890,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'distribute-vertical',
 				kbd: '?!V',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('distribute-shapes', { operation: 'vertical', source })
 					editor.markHistoryStoppingPoint('distribute vertical')
@@ -892,7 +899,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return distributeEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && distributeEnabled
 				},
 			},
 			{
@@ -903,8 +910,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				icon: 'stretch-horizontal',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('stretch-shapes', { operation: 'horizontal', source })
 					editor.markHistoryStoppingPoint('stretch horizontal')
@@ -913,7 +919,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 			},
 			{
@@ -924,8 +930,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				icon: 'stretch-vertical',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('stretch-shapes', { operation: 'vertical', source })
 					editor.markHistoryStoppingPoint('stretch vertical')
@@ -934,7 +939,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return alignEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
 			},
 			{
@@ -945,8 +950,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				kbd: '!h',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('flip-shapes', { operation: 'horizontal', source })
 					editor.markHistoryStoppingPoint('flip horizontal')
@@ -955,7 +959,11 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return !!(twoSelected || onlyFlippableShapeSelected)
+					return (
+						canApplySelectionAction() &&
+						!mustGoBackToSelectToolFirst() &&
+						!!(twoSelected || onlyFlippableShapeSelected)
+					)
 				},
 			},
 			{
@@ -963,8 +971,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: { default: 'action.flip-vertical', ['context-menu']: 'action.flip-vertical.short' },
 				kbd: '!v',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('flip-shapes', { operation: 'vertical', source })
 					editor.markHistoryStoppingPoint('flip vertical')
@@ -973,7 +980,11 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return !!(twoSelected || onlyFlippableShapeSelected)
+					return (
+						canApplySelectionAction() &&
+						!mustGoBackToSelectToolFirst() &&
+						!!(twoSelected || onlyFlippableShapeSelected)
+					)
 				},
 			},
 			{
@@ -981,8 +992,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.pack',
 				icon: 'pack',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('pack-shapes', { source })
 					editor.markHistoryStoppingPoint('pack')
@@ -991,7 +1001,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return threeStackableItems
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && threeStackableItems
 				},
 			},
 			{
@@ -1002,8 +1012,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				icon: 'stack-vertical',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('stack-shapes', { operation: 'vertical', source })
 					editor.markHistoryStoppingPoint('stack-vertical')
@@ -1012,7 +1021,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return stackingEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && stackingEnabled
 				},
 			},
 			{
@@ -1023,8 +1032,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				icon: 'stack-horizontal',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('stack-shapes', { operation: 'horizontal', source })
 					editor.markHistoryStoppingPoint('stack-horizontal')
@@ -1033,7 +1041,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return stackingEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && stackingEnabled
 				},
 			},
 			{
@@ -1042,15 +1050,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: ']',
 				icon: 'bring-to-front',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('reorder-shapes', { operation: 'toFront', source })
 					editor.markHistoryStoppingPoint('bring to front')
 					editor.bringToFront(editor.getSelectedShapeIds())
 				},
 				enabled() {
-					return reorderingEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && reorderingEnabled
 				},
 			},
 			{
@@ -1059,15 +1066,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'bring-forward',
 				kbd: '?]',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('reorder-shapes', { operation: 'forward', source })
 					editor.markHistoryStoppingPoint('bring forward')
 					editor.bringForward(editor.getSelectedShapeIds())
 				},
 				enabled() {
-					return reorderingEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && reorderingEnabled
 				},
 			},
 			{
@@ -1076,15 +1082,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'send-backward',
 				kbd: '?[',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('reorder-shapes', { operation: 'backward', source })
 					editor.markHistoryStoppingPoint('send backward')
 					editor.sendBackward(editor.getSelectedShapeIds())
 				},
 				enabled() {
-					return reorderingEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && reorderingEnabled
 				},
 			},
 			{
@@ -1093,15 +1098,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'send-to-back',
 				kbd: '[',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('reorder-shapes', { operation: 'toBack', source })
 					editor.markHistoryStoppingPoint('send to back')
 					editor.sendToBack(editor.getSelectedShapeIds())
 				},
 				enabled() {
-					return reorderingEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && reorderingEnabled
 				},
 			},
 			{
@@ -1109,14 +1113,13 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.cut',
 				kbd: '$x',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					editor.markHistoryStoppingPoint('cut')
 					cut(source)
 				},
 				enabled() {
-					return !!oneSelected
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && !!oneSelected
 				},
 			},
 			{
@@ -1125,13 +1128,12 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '$c',
 				readonlyOk: true,
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					copy(source)
 				},
 				enabled() {
-					return !!oneSelected
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && !!oneSelected
 				},
 			},
 			{
@@ -1139,6 +1141,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.paste',
 				kbd: '$v',
 				onSelect(source) {
+					if (!this.enabled()) return
 					navigator.clipboard
 						?.read()
 						.then((clipboardItems) => {
@@ -1166,9 +1169,8 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '$a',
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					editor.run(() => {
-						if (mustGoBackToSelectToolFirst()) return
-
 						trackEvent('select-all-shapes', { source })
 
 						editor.markHistoryStoppingPoint('select all kbd')
@@ -1176,7 +1178,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					})
 				},
 				enabled() {
-					return pageHasShapes
+					return !mustGoBackToSelectToolFirst() && pageHasShapes
 				},
 			},
 			{
@@ -1184,15 +1186,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.select-none',
 				readonlyOk: true,
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('select-none-shapes', { source })
 					editor.markHistoryStoppingPoint('select none')
 					editor.selectNone()
 				},
 				enabled() {
-					return !!oneSelected
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && !!oneSelected
 				},
 			},
 			{
@@ -1201,15 +1202,18 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: ',del,backspace',
 				icon: 'trash',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('delete-shapes', { source })
 					editor.markHistoryStoppingPoint('delete')
 					editor.deleteShapes(editor.getSelectedShapeIds())
 				},
 				enabled() {
-					return !!(oneSelected && isInSelectState)
+					return (
+						canApplySelectionAction() &&
+						!mustGoBackToSelectToolFirst() &&
+						!!(oneSelected && isInSelectState)
+					)
 				},
 			},
 			{
@@ -1217,8 +1221,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.rotate-cw',
 				icon: 'rotate-cw',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('rotate-cw', { source })
 					editor.markHistoryStoppingPoint('rotate-cw')
@@ -1229,7 +1232,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return rotateEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && rotateEnabled
 				},
 			},
 			{
@@ -1237,8 +1240,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.rotate-ccw',
 				icon: 'rotate-ccw',
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('rotate-ccw', { source })
 					editor.markHistoryStoppingPoint('rotate-ccw')
@@ -1249,7 +1251,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					kickoutOccludedShapes(editor, selectedShapeIds)
 				},
 				enabled() {
-					return rotateEnabled
+					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && rotateEnabled
 				},
 			},
 			{
@@ -1289,13 +1291,14 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '!0',
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('reset-zoom', { source })
 					editor.resetZoom(undefined, {
 						animation: { duration: editor.options.animationMediumMs },
 					})
 				},
 				enabled() {
-					return editor.getZoomLevel() === 1
+					return editor.getZoomLevel() !== 1
 				},
 			},
 			{
@@ -1304,6 +1307,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '!1',
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('zoom-to-fit', { source })
 					editor.zoomToFit({ animation: { duration: editor.options.animationMediumMs } })
 				},
@@ -1317,14 +1321,17 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '!2',
 				readonlyOk: true,
 				onSelect(source) {
-					if (!canApplySelectionAction()) return
-					if (mustGoBackToSelectToolFirst()) return
+					if (!this.enabled()) return
 
 					trackEvent('zoom-to-selection', { source })
 					editor.zoomToSelection({ animation: { duration: editor.options.animationMediumMs } })
 				},
 				enabled() {
-					return editor.getCurrentPageShapeIds().size > 0
+					return (
+						canApplySelectionAction() &&
+						!mustGoBackToSelectToolFirst() &&
+						editor.getCurrentPageShapeIds().size > 0
+					)
 				},
 			},
 			{
@@ -1491,6 +1498,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				id: 'unlock-all',
 				label: 'action.unlock-all',
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('unlock-all', { source })
 					const updates = [] as TLShapePartial[]
 					for (const shape of editor.getCurrentPageShapes()) {
@@ -1572,6 +1580,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				kbd: '$p',
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('print', { source })
 					printSelectionOrPages()
 				},
@@ -1585,6 +1594,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'cross-2',
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('exit-pen-mode', { source })
 					editor.updateInstanceState({ isPenMode: false })
 				},
@@ -1598,6 +1608,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'cross-2',
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
 					trackEvent('stop-following', { source })
 					editor.stopFollowingUser()
 				},
@@ -1611,16 +1622,18 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				icon: 'arrow-left',
 				readonlyOk: true,
 				onSelect(source) {
+					if (!this.enabled()) return
+
 					trackEvent('zoom-to-content', { source })
-					const bounds = editor.getSelectionPageBounds() ?? editor.getCurrentPageBounds()
-					if (!bounds) return
+					const bounds = editor.getSelectionPageBounds() ?? editor.getCurrentPageBounds()!
 					editor.zoomToBounds(bounds, {
 						targetZoom: Math.min(1, editor.getZoomLevel()),
 						animation: { duration: 220 },
 					})
 				},
 				enabled() {
-					return backToContentEnabled
+					const bounds = editor.getSelectionPageBounds() ?? editor.getCurrentPageBounds()
+					return !!bounds && backToContentEnabled
 				},
 			},
 			{
@@ -1628,6 +1641,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				label: 'action.toggle-lock',
 				kbd: '!l',
 				onSelect(source) {
+					if (!this.enabled()) return
 					editor.markHistoryStoppingPoint('locking')
 					trackEvent('toggle-lock', { source })
 					editor.toggleLock(editor.getSelectedShapeIds())
@@ -1643,6 +1657,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					'command-bar': 'command-bar.move-to-new-page',
 				},
 				onSelect(source) {
+					if (!this.enabled()) return
 					const newPageId = PageRecordType.createId()
 					const ids = editor.getSelectedShapeIds()
 					editor.run(() => {
@@ -1698,9 +1713,9 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				id: 'flatten-to-image',
 				label: 'action.flatten-to-image',
 				kbd: '!f',
-				onSelect: async (source) => {
+				onSelect: async function (source) {
+					if (!this.enabled()) return
 					const ids = editor.getSelectedShapeIds()
-					if (ids.length === 0) return
 
 					editor.markHistoryStoppingPoint('flattening to image')
 					trackEvent('flatten-to-image', { source })
@@ -1716,7 +1731,8 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					}
 				},
 				enabled() {
-					return flattenToImagesEnabled
+					const ids = editor.getSelectedShapeIds()
+					return ids.length > 0 && flattenToImagesEnabled
 				},
 			},
 		]
@@ -1728,6 +1744,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				readonlyOk: true,
 				kbd: '/',
 				onSelect(source: any) {
+					if (!this.enabled()) return
 					trackEvent('open-cursor-chat', { source })
 
 					// Don't open cursor chat if we're on a touch device
-- 
2.52.0


From a03a4298925c7d5121e62927a1a0f7d9e43e8c00 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 11 Sep 2024 15:27:09 +0200
Subject: [PATCH 22/28] Fix an issue with binding.

---
 packages/tldraw/src/lib/ui/context/actions.tsx | 1 +
 1 file changed, 1 insertion(+)

diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index 76ceb83cb..f40067e82 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -1762,6 +1762,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 			})
 		}
+		actionItems.map((a) => (a.onSelect = a.onSelect.bind(a)))
 
 		const actions = makeActions(actionItems)
 
-- 
2.52.0


From 1d38267726fd527d69ad32fe80b7d27138d721e0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 18 Sep 2024 14:29:10 +0200
Subject: [PATCH 23/28] Fix locking and zooming tests.

---
 apps/examples/e2e/tests/test-kbds.spec.ts | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/apps/examples/e2e/tests/test-kbds.spec.ts b/apps/examples/e2e/tests/test-kbds.spec.ts
index 16add9282..d7e5c816a 100644
--- a/apps/examples/e2e/tests/test-kbds.spec.ts
+++ b/apps/examples/e2e/tests/test-kbds.spec.ts
@@ -140,6 +140,8 @@ test.describe('Keyboard Shortcuts', () => {
 	})
 
 	test('Zoom to 100', async () => {
+		// Let's zoom in first, so that we are not at 100%
+		await page.keyboard.press('Control+=')
 		await page.keyboard.press('Shift+0')
 		expect(await page.evaluate(() => __tldraw_ui_event)).toMatchObject({
 			name: 'reset-zoom',
@@ -342,6 +344,14 @@ test.describe('Actions on shapes', () => {
 
 		/* ---------------------- Misc ---------------------- */
 
+		// Make some shapes which we will lock
+		await page.keyboard.press('r')
+		await page.mouse.click(100, 100)
+		await page.keyboard.press('r')
+		await page.mouse.click(250, 250)
+		await page.keyboard.press('v')
+		await page.keyboard.press('Control+a')
+
 		// toggle lock
 		await page.keyboard.press('Shift+l')
 		expect(await page.evaluate(() => __tldraw_ui_event)).toMatchObject({
-- 
2.52.0


From 0588775da594530478497c38bbea922309557244 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 18 Sep 2024 15:28:14 +0200
Subject: [PATCH 24/28] Add disabled descriptions.

---
 assets/translations/main.json                 | 19 ++++++++
 packages/tldraw/api-report.md                 |  4 +-
 .../CommandBar/DefaultCommandBar.tsx          |  2 +-
 .../tldraw/src/lib/ui/context/actions.tsx     | 48 ++++++++++++++++++-
 .../useTranslation/TLUiTranslationKey.ts      | 19 ++++++++
 .../useTranslation/defaultTranslation.ts      | 22 +++++++++
 6 files changed, 109 insertions(+), 5 deletions(-)

diff --git a/assets/translations/main.json b/assets/translations/main.json
index 412e484a0..d26098922 100644
--- a/assets/translations/main.json
+++ b/assets/translations/main.json
@@ -1,7 +1,10 @@
 {
 	"action.convert-to-bookmark": "Convert to Bookmark",
+	"action.convert-to-bookmark-disabled-description": "You need to have a single embed shape selected",
 	"action.convert-to-embed": "Convert to Embed",
+	"action.convert-to-embed-disabled-description": "You need to have a single bookmark shape selected",
 	"action.open-embed-link": "Open link",
+	"action.align-disabled-description": "You need to have at least two shapes selected",
 	"action.align-bottom": "Align bottom",
 	"action.align-center-horizontal": "Align horizontally",
 	"action.align-center-vertical": "Align vertically",
@@ -13,6 +16,7 @@
 	"action.back-to-content": "Back to content",
 	"action.bring-forward": "Bring forward",
 	"action.bring-to-front": "Bring to front",
+	"action.copy-as-disabled-description": "You need some shapes to copy",
 	"action.copy-as-json.short": "JSON",
 	"action.copy-as-json": "Copy as JSON",
 	"action.copy-as-png.short": "PNG",
@@ -23,13 +27,17 @@
 	"action.cut": "Cut",
 	"action.delete": "Delete",
 	"action.unlock-all": "Unlock all",
+	"action.distribute-disabled-description": "You need to have at least three shapes selected",
 	"action.distribute-horizontal": "Distribute horizontally",
 	"action.distribute-vertical": "Distribute vertically",
 	"action.distribute-horizontal.short": "Distribute H",
 	"action.distribute-vertical.short": "Distribute V",
 	"action.duplicate": "Duplicate",
 	"action.edit-link": "Edit link",
+	"action.edit-link-disabled-description": "Select a shape that supports link editing",
 	"action.exit-pen-mode": "Exit pen mode",
+	"action.exit-pen-mode-disabled-description": "Not in pen mode",
+	"action.export-as-disabled-description": "You need some shapes to export",
 	"action.export-as-json.short": "JSON",
 	"action.export-as-json": "Export as JSON",
 	"action.export-as-png.short": "PNG",
@@ -46,6 +54,7 @@
 	"action.export-all-as-svg.long": "Export all as SVG",
 	"action.export-all-as-svg": "Export as SVG",
 	"action.fit-frame-to-content": "Fit to content",
+	"action.fit-frame-to-content-disabled-description": "You need to have a frame with content selected",
 	"action.flip-horizontal": "Flip horizontally",
 	"action.flip-vertical": "Flip vertically",
 	"action.flip-horizontal.short": "Flip H",
@@ -53,20 +62,26 @@
 	"action.fork-project": "Fork this project",
 	"action.fork-project-on-tldraw": "Fork project on tldraw",
 	"action.group": "Group",
+	"action.group-disabled-description": "You need to have at least two shapes selected",
 	"action.insert-embed": "Insert embed",
 	"action.insert-media": "Upload media",
 	"action.leave-shared-project": "Leave shared project",
+	"action.no-shapes-selected": "You need to have some shapes selected",
+	"action.no-shapes-on-page": "There are no shapes on this page",
 	"action.new-project": "New project",
 	"action.new-shared-project": "New shared project",
 	"action.open-cursor-chat": "Cursor chat",
 	"action.open-file": "Open file",
 	"action.pack": "Pack",
 	"action.paste": "Paste",
+	"action.paste-disabled-description": "This browser does not support pasting",
 	"action.paste-error-title": "Pasting failed",
 	"action.paste-error-description": "Could not paste due to missing clipboard permissions. Please enable the permissions and try again.",
 	"action.print": "Print",
+	"action.redo-disabled-description": "Nothing to redo",
 	"action.redo": "Redo",
 	"action.remove-frame": "Remove frame",
+	"action.remove-frame-disabled-description": "You need to have a frame selected",
 	"action.rename": "Rename",
 	"action.rotate-ccw": "Rotate counterclockwise",
 	"action.rotate-cw": "Rotate clockwise",
@@ -81,6 +96,7 @@
 	"action.stack-horizontal.short": "Stack H",
 	"action.stack-vertical.short": "Stack V",
 	"action.stop-following": "Stop following",
+	"action.stop-following-disabled-description": "Not following anyone",
 	"action.stretch-horizontal": "Stretch horizontally",
 	"action.stretch-vertical": "Stretch vertically",
 	"action.stretch-horizontal.short": "Stretch H",
@@ -106,6 +122,7 @@
 	"action.toggle-grid": "Toggle grid",
 	"action.toggle-lock": "Toggle locked",
 	"action.flatten-to-image": "Flatten",
+	"action.flatten-to-image-disabled-description": "You need to have some shapes selected",
 	"action.toggle-snap-mode.menu": "Always snap",
 	"action.toggle-snap-mode": "Toggle always snap",
 	"action.toggle-tool-lock.menu": "Tool lock",
@@ -113,8 +130,10 @@
 	"action.toggle-transparent.context-menu": "Transparent",
 	"action.toggle-transparent.menu": "Transparent",
 	"action.toggle-transparent": "Toggle transparent background",
+	"action.undo-disabled-description": "Nothing to undo",
 	"action.undo": "Undo",
 	"action.ungroup": "Ungroup",
+	"action.ungroup-disabled-description": "You need to have a group selected",
 	"action.zoom-in": "Zoom in",
 	"action.zoom-out": "Zoom out",
 	"action.zoom-to-100": "Zoom to 100%",
diff --git a/packages/tldraw/api-report.md b/packages/tldraw/api-report.md
index a5cc06704..b504d9cfa 100644
--- a/packages/tldraw/api-report.md
+++ b/packages/tldraw/api-report.md
@@ -2247,7 +2247,7 @@ export interface TLUiActionItem<TransationKey extends string = string, IconType
     // (undocumented)
     checkbox?: boolean;
     // (undocumented)
-    disabledDescription?: string;
+    disabledDescription?: TransationKey;
     // (undocumented)
     enabled(): boolean;
     // (undocumented)
@@ -3124,7 +3124,7 @@ export interface TLUiTranslation {
 export type TLUiTranslationContextType = TLUiTranslation;
 
 // @public (undocumented)
-export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark' | 'action.convert-to-embed' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link' | 'action.exit-pen-mode' | 'action.export-all-as-json.long' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.long' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.long' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'command-bar.move-to-new-page' | 'command-bar.placeholder' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
+export type TLUiTranslationKey = 'action.align-bottom' | 'action.align-center-horizontal.short' | 'action.align-center-horizontal' | 'action.align-center-vertical.short' | 'action.align-center-vertical' | 'action.align-disabled-description' | 'action.align-left' | 'action.align-right' | 'action.align-top' | 'action.back-to-content' | 'action.bring-forward' | 'action.bring-to-front' | 'action.convert-to-bookmark-disabled-description' | 'action.convert-to-bookmark' | 'action.convert-to-embed-disabled-description' | 'action.convert-to-embed' | 'action.copy-as-disabled-description' | 'action.copy-as-json.short' | 'action.copy-as-json' | 'action.copy-as-png.short' | 'action.copy-as-png' | 'action.copy-as-svg.short' | 'action.copy-as-svg' | 'action.copy' | 'action.cut' | 'action.delete' | 'action.distribute-disabled-description' | 'action.distribute-horizontal.short' | 'action.distribute-horizontal' | 'action.distribute-vertical.short' | 'action.distribute-vertical' | 'action.duplicate' | 'action.edit-link-disabled-description' | 'action.edit-link' | 'action.exit-pen-mode-disabled-description' | 'action.exit-pen-mode' | 'action.export-all-as-json.long' | 'action.export-all-as-json.short' | 'action.export-all-as-json' | 'action.export-all-as-png.long' | 'action.export-all-as-png.short' | 'action.export-all-as-png' | 'action.export-all-as-svg.long' | 'action.export-all-as-svg.short' | 'action.export-all-as-svg' | 'action.export-as-disabled-description' | 'action.export-as-json.short' | 'action.export-as-json' | 'action.export-as-png.short' | 'action.export-as-png' | 'action.export-as-svg.short' | 'action.export-as-svg' | 'action.fit-frame-to-content-disabled-description' | 'action.fit-frame-to-content' | 'action.flatten-to-image-disabled-description' | 'action.flatten-to-image' | 'action.flip-horizontal.short' | 'action.flip-horizontal' | 'action.flip-vertical.short' | 'action.flip-vertical' | 'action.fork-project-on-tldraw' | 'action.fork-project' | 'action.group-disabled-description' | 'action.group' | 'action.insert-embed' | 'action.insert-media' | 'action.leave-shared-project' | 'action.new-project' | 'action.new-shared-project' | 'action.no-shapes-on-page' | 'action.no-shapes-selected' | 'action.open-cursor-chat' | 'action.open-embed-link' | 'action.open-file' | 'action.pack' | 'action.paste-disabled-description' | 'action.paste-error-description' | 'action.paste-error-title' | 'action.paste' | 'action.print' | 'action.redo-disabled-description' | 'action.redo' | 'action.remove-frame-disabled-description' | 'action.remove-frame' | 'action.rename' | 'action.rotate-ccw' | 'action.rotate-cw' | 'action.save-copy' | 'action.select-all' | 'action.select-none' | 'action.send-backward' | 'action.send-to-back' | 'action.share-project' | 'action.stack-horizontal.short' | 'action.stack-horizontal' | 'action.stack-vertical.short' | 'action.stack-vertical' | 'action.stop-following-disabled-description' | 'action.stop-following' | 'action.stretch-horizontal.short' | 'action.stretch-horizontal' | 'action.stretch-vertical.short' | 'action.stretch-vertical' | 'action.toggle-auto-size' | 'action.toggle-dark-mode.menu' | 'action.toggle-dark-mode' | 'action.toggle-debug-mode.menu' | 'action.toggle-debug-mode' | 'action.toggle-dynamic-size-mode.menu' | 'action.toggle-dynamic-size-mode' | 'action.toggle-edge-scrolling.menu' | 'action.toggle-edge-scrolling' | 'action.toggle-focus-mode.menu' | 'action.toggle-focus-mode' | 'action.toggle-grid.menu' | 'action.toggle-grid' | 'action.toggle-lock' | 'action.toggle-paste-at-cursor.menu' | 'action.toggle-paste-at-cursor' | 'action.toggle-reduce-motion.menu' | 'action.toggle-reduce-motion' | 'action.toggle-snap-mode.menu' | 'action.toggle-snap-mode' | 'action.toggle-tool-lock.menu' | 'action.toggle-tool-lock' | 'action.toggle-transparent.context-menu' | 'action.toggle-transparent.menu' | 'action.toggle-transparent' | 'action.toggle-wrap-mode.menu' | 'action.toggle-wrap-mode' | 'action.undo-disabled-description' | 'action.undo' | 'action.ungroup-disabled-description' | 'action.ungroup' | 'action.unlock-all' | 'action.zoom-in' | 'action.zoom-out' | 'action.zoom-to-100' | 'action.zoom-to-fit' | 'action.zoom-to-selection' | 'actions-menu.title' | 'align-style.end' | 'align-style.justify' | 'align-style.middle' | 'align-style.start' | 'arrowheadEnd-style.arrow' | 'arrowheadEnd-style.bar' | 'arrowheadEnd-style.diamond' | 'arrowheadEnd-style.dot' | 'arrowheadEnd-style.inverted' | 'arrowheadEnd-style.none' | 'arrowheadEnd-style.pipe' | 'arrowheadEnd-style.square' | 'arrowheadEnd-style.triangle' | 'arrowheadStart-style.arrow' | 'arrowheadStart-style.bar' | 'arrowheadStart-style.diamond' | 'arrowheadStart-style.dot' | 'arrowheadStart-style.inverted' | 'arrowheadStart-style.none' | 'arrowheadStart-style.pipe' | 'arrowheadStart-style.square' | 'arrowheadStart-style.triangle' | 'assets.files.size-too-big' | 'assets.files.type-not-allowed' | 'assets.files.upload-failed' | 'assets.url.failed' | 'color-style.black' | 'color-style.blue' | 'color-style.green' | 'color-style.grey' | 'color-style.light-blue' | 'color-style.light-green' | 'color-style.light-red' | 'color-style.light-violet' | 'color-style.orange' | 'color-style.red' | 'color-style.violet' | 'color-style.white' | 'color-style.yellow' | 'command-bar.move-to-new-page' | 'command-bar.placeholder' | 'context-menu.arrange' | 'context-menu.copy-as' | 'context-menu.edit' | 'context-menu.export-all-as' | 'context-menu.export-as' | 'context-menu.move-to-page' | 'context-menu.reorder' | 'context.pages.new-page' | 'cursor-chat.type-to-chat' | 'dash-style.dashed' | 'dash-style.dotted' | 'dash-style.draw' | 'dash-style.solid' | 'debug-panel.more' | 'document-name-menu.copy-link' | 'document.default-name' | 'edit-link-dialog.cancel' | 'edit-link-dialog.clear' | 'edit-link-dialog.detail' | 'edit-link-dialog.invalid-url' | 'edit-link-dialog.save' | 'edit-link-dialog.title' | 'edit-link-dialog.url' | 'edit-pages-dialog.move-down' | 'edit-pages-dialog.move-up' | 'embed-dialog.back' | 'embed-dialog.cancel' | 'embed-dialog.create' | 'embed-dialog.instruction' | 'embed-dialog.invalid-url' | 'embed-dialog.title' | 'embed-dialog.url' | 'file-system.confirm-clear.cancel' | 'file-system.confirm-clear.continue' | 'file-system.confirm-clear.description' | 'file-system.confirm-clear.dont-show-again' | 'file-system.confirm-clear.title' | 'file-system.confirm-open.cancel' | 'file-system.confirm-open.description' | 'file-system.confirm-open.dont-show-again' | 'file-system.confirm-open.open' | 'file-system.confirm-open.title' | 'file-system.file-open-error.file-format-version-too-new' | 'file-system.file-open-error.generic-corrupted-file' | 'file-system.file-open-error.not-a-tldraw-file' | 'file-system.file-open-error.title' | 'file-system.shared-document-file-open-error.description' | 'file-system.shared-document-file-open-error.title' | 'fill-style.fill' | 'fill-style.none' | 'fill-style.pattern' | 'fill-style.semi' | 'fill-style.solid' | 'focus-mode.toggle-focus-mode' | 'font-style.draw' | 'font-style.mono' | 'font-style.sans' | 'font-style.serif' | 'geo-style.arrow-down' | 'geo-style.arrow-left' | 'geo-style.arrow-right' | 'geo-style.arrow-up' | 'geo-style.check-box' | 'geo-style.cloud' | 'geo-style.diamond' | 'geo-style.ellipse' | 'geo-style.hexagon' | 'geo-style.octagon' | 'geo-style.oval' | 'geo-style.pentagon' | 'geo-style.rectangle' | 'geo-style.rhombus-2' | 'geo-style.rhombus' | 'geo-style.star' | 'geo-style.trapezoid' | 'geo-style.triangle' | 'geo-style.x-box' | 'help-menu.about' | 'help-menu.discord' | 'help-menu.docs' | 'help-menu.github' | 'help-menu.keyboard-shortcuts' | 'help-menu.privacy' | 'help-menu.terms' | 'help-menu.title' | 'help-menu.twitter' | 'home-project-dialog.description' | 'home-project-dialog.ok' | 'home-project-dialog.title' | 'menu.copy-as' | 'menu.edit' | 'menu.export-as' | 'menu.file' | 'menu.help' | 'menu.language' | 'menu.preferences' | 'menu.theme' | 'menu.title' | 'menu.view' | 'navigation-zone.toggle-minimap' | 'navigation-zone.zoom' | 'opacity-style.0.1' | 'opacity-style.0.25' | 'opacity-style.0.5' | 'opacity-style.0.75' | 'opacity-style.1' | 'page-menu.create-new-page' | 'page-menu.edit-done' | 'page-menu.edit-start' | 'page-menu.go-to-page' | 'page-menu.max-page-count-reached' | 'page-menu.new-page-initial-name' | 'page-menu.submenu.delete' | 'page-menu.submenu.duplicate-page' | 'page-menu.submenu.move-down' | 'page-menu.submenu.move-up' | 'page-menu.submenu.rename' | 'page-menu.submenu.title' | 'page-menu.title' | 'people-menu.change-color' | 'people-menu.change-name' | 'people-menu.follow' | 'people-menu.following' | 'people-menu.invite' | 'people-menu.leading' | 'people-menu.title' | 'people-menu.user' | 'rename-project-dialog.cancel' | 'rename-project-dialog.rename' | 'rename-project-dialog.title' | 'share-menu.copied' | 'share-menu.copy-link-note' | 'share-menu.copy-link' | 'share-menu.copy-readonly-link-note' | 'share-menu.copy-readonly-link' | 'share-menu.create-snapshot-link' | 'share-menu.creating-project' | 'share-menu.default-project-name' | 'share-menu.fork-note' | 'share-menu.offline-note' | 'share-menu.project-too-large' | 'share-menu.readonly-link' | 'share-menu.save-note' | 'share-menu.share-project' | 'share-menu.snapshot-link-note' | 'share-menu.title' | 'share-menu.upload-failed' | 'sharing.confirm-leave.cancel' | 'sharing.confirm-leave.description' | 'sharing.confirm-leave.dont-show-again' | 'sharing.confirm-leave.leave' | 'sharing.confirm-leave.title' | 'shortcuts-dialog.collaboration' | 'shortcuts-dialog.edit' | 'shortcuts-dialog.file' | 'shortcuts-dialog.preferences' | 'shortcuts-dialog.title' | 'shortcuts-dialog.tools' | 'shortcuts-dialog.transform' | 'shortcuts-dialog.view' | 'size-style.l' | 'size-style.m' | 'size-style.s' | 'size-style.xl' | 'spline-style.cubic' | 'spline-style.line' | 'status.offline' | 'status.online' | 'style-panel.align' | 'style-panel.arrowhead-end' | 'style-panel.arrowhead-start' | 'style-panel.arrowheads' | 'style-panel.color' | 'style-panel.dash' | 'style-panel.fill' | 'style-panel.font' | 'style-panel.geo' | 'style-panel.mixed' | 'style-panel.opacity' | 'style-panel.position' | 'style-panel.size' | 'style-panel.spline' | 'style-panel.title' | 'style-panel.vertical-align' | 'theme.dark' | 'theme.light' | 'theme.system' | 'toast.close' | 'toast.error.copy-fail.desc' | 'toast.error.copy-fail.title' | 'toast.error.export-fail.desc' | 'toast.error.export-fail.title' | 'tool-panel.drawing' | 'tool-panel.more' | 'tool-panel.shapes' | 'tool.arrow-down' | 'tool.arrow-left' | 'tool.arrow-right' | 'tool.arrow-up' | 'tool.arrow' | 'tool.asset' | 'tool.check-box' | 'tool.cloud' | 'tool.diamond' | 'tool.draw' | 'tool.ellipse' | 'tool.embed' | 'tool.eraser' | 'tool.frame' | 'tool.hand' | 'tool.hexagon' | 'tool.highlight' | 'tool.laser' | 'tool.line' | 'tool.note' | 'tool.octagon' | 'tool.oval' | 'tool.pentagon' | 'tool.pointer-down' | 'tool.rectangle' | 'tool.rhombus' | 'tool.select' | 'tool.star' | 'tool.text' | 'tool.trapezoid' | 'tool.triangle' | 'tool.x-box' | 'verticalAlign-style.end' | 'verticalAlign-style.middle' | 'verticalAlign-style.start' | 'vscode.file-open.backup-failed' | 'vscode.file-open.backup-saved' | 'vscode.file-open.backup' | 'vscode.file-open.desc' | 'vscode.file-open.dont-show-again' | 'vscode.file-open.open';
 
 // @public (undocumented)
 export interface TLUiTranslationProviderProps {
diff --git a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
index 0fd065ab4..94719c368 100644
--- a/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
+++ b/packages/tldraw/src/lib/ui/components/CommandBar/DefaultCommandBar.tsx
@@ -215,7 +215,7 @@ function CommandBarItem({
 			</div>
 			{showDisabledDescription && (
 				<span className="tlui-command-bar__item-disabled-description">
-					{action.disabledDescription}
+					{msg(action.disabledDescription)}
 				</span>
 			)}
 		</div>
diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index f40067e82..dbcdc7bb9 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -70,7 +70,7 @@ export interface TLUiActionItem<
 	checkbox?: boolean
 	onSelect(source: TLUiEventSource): Promise<void> | void
 	enabled(): boolean
-	disabledDescription?: string
+	disabledDescription?: TransationKey
 }
 
 /** @public */
@@ -191,6 +191,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && editLinkEnabled
 				},
+				disabledDescription: 'action.edit-link-disabled-description',
 			},
 			{
 				id: 'insert-embed',
@@ -229,6 +230,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return editor.getCanUndo()
 				},
+				disabledDescription: 'action.undo-disabled-description',
 			},
 			{
 				id: 'redo',
@@ -243,6 +245,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return editor.getCanRedo()
 				},
+				disabledDescription: 'action.redo-disabled-description',
 			},
 			{
 				id: 'export-as-svg',
@@ -262,6 +265,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = getSelectedOrPageShapeIds(editor)
 					return !!ids && pageHasShapes
 				},
+				disabledDescription: 'action.export-as-disabled-description',
 			},
 			{
 				id: 'export-as-png',
@@ -281,6 +285,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = getSelectedOrPageShapeIds(editor)!
 					return !!ids && pageHasShapes
 				},
+				disabledDescription: 'action.export-as-disabled-description',
 			},
 			{
 				id: 'export-as-json',
@@ -301,6 +306,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = getSelectedOrPageShapeIds(editor)!
 					return !!ids && pageHasShapes
 				},
+				disabledDescription: 'action.export-as-disabled-description',
 			},
 			{
 				id: 'export-all-as-svg',
@@ -325,6 +331,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = editor.getCurrentPageShapeIds()
 					return !!ids
 				},
+				disabledDescription: 'action.export-as-disabled-description',
 			},
 			{
 				id: 'export-all-as-png',
@@ -345,6 +352,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = editor.getCurrentPageShapeIds()
 					return ids.size > 0
 				},
+				disabledDescription: 'action.export-as-disabled-description',
 			},
 			{
 				id: 'export-all-as-json',
@@ -365,6 +373,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = editor.getCurrentPageShapeIds()
 					return ids.size > 0
 				},
+				disabledDescription: 'action.export-as-disabled-description',
 			},
 			{
 				id: 'copy-as-svg',
@@ -385,6 +394,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = getSelectedOrPageShapeIds(editor)
 					return !!ids
 				},
+				disabledDescription: 'action.copy-as-disabled-description',
 			},
 			{
 				id: 'copy-as-png',
@@ -404,6 +414,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = getSelectedOrPageShapeIds(editor)
 					return !!ids
 				},
+				disabledDescription: 'action.copy-as-disabled-description',
 			},
 			{
 				id: 'copy-as-json',
@@ -423,6 +434,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = getSelectedOrPageShapeIds(editor)
 					return !!ids
 				},
+				disabledDescription: 'action.copy-as-disabled-description',
 			},
 			{
 				id: 'toggle-auto-size',
@@ -549,6 +561,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						canApplySelectionAction() && !mustGoBackToSelectToolFirst() && convertToBookmarkEnabled
 					)
 				},
+				disabledDescription: 'action.convert-to-bookmark-disabled-description',
 			},
 			{
 				id: 'convert-to-embed',
@@ -608,6 +621,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						canApplySelectionAction() && !mustGoBackToSelectToolFirst() && convertToEmbedEnabled
 					)
 				},
+				disabledDescription: 'action.convert-to-embed-disabled-description',
 			},
 			{
 				id: 'duplicate',
@@ -661,6 +675,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						!!(oneSelected && isInSelectState)
 					)
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'ungroup',
@@ -677,6 +692,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && allowUngroup
 				},
+				disabledDescription: 'action.ungroup-disabled-description',
 			},
 			{
 				id: 'group',
@@ -703,6 +719,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						!!(allowGroup && twoSelected && isInSelectState)
 					)
 				},
+				disabledDescription: 'action.group-disabled-description',
 			},
 			{
 				id: 'remove-frame',
@@ -727,6 +744,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && removeFrameEnabled
 				},
+				disabledDescription: 'action.remove-frame-disabled-description',
 			},
 			{
 				id: 'fit-frame-to-content',
@@ -744,6 +762,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && fitFrameToContentEnabled
 				},
+				disabledDescription: 'action.fit-frame-to-content-disabled-description',
 			},
 			{
 				id: 'align-left',
@@ -762,7 +781,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
-				disabledDescription: 'You need to have at least two shapes selected',
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'align-center-horizontal',
@@ -784,6 +803,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'align-right',
@@ -802,6 +822,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'align-center-vertical',
@@ -823,6 +844,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'align-top',
@@ -841,6 +863,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'align-bottom',
@@ -859,6 +882,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'distribute-horizontal',
@@ -880,6 +904,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && distributeEnabled
 				},
+				disabledDescription: 'action.distribute-disabled-description',
 			},
 			{
 				id: 'distribute-vertical',
@@ -901,6 +926,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && distributeEnabled
 				},
+				disabledDescription: 'action.distribute-disabled-description',
 			},
 			{
 				id: 'stretch-horizontal',
@@ -921,6 +947,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'stretch-vertical',
@@ -941,6 +968,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && alignEnabled
 				},
+				disabledDescription: 'action.align-disabled-description',
 			},
 			{
 				id: 'flip-horizontal',
@@ -1121,6 +1149,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && !!oneSelected
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'copy',
@@ -1135,6 +1164,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && !!oneSelected
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'paste',
@@ -1162,6 +1192,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return showMenuPaste
 				},
+				disabledDescription: 'action.paste-disabled-description',
 			},
 			{
 				id: 'select-all',
@@ -1180,6 +1211,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return !mustGoBackToSelectToolFirst() && pageHasShapes
 				},
+				disabledDescription: 'action.no-shapes-on-page',
 			},
 			{
 				id: 'select-none',
@@ -1195,6 +1227,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && !!oneSelected
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'delete',
@@ -1215,6 +1248,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						!!(oneSelected && isInSelectState)
 					)
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'rotate-cw',
@@ -1234,6 +1268,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && rotateEnabled
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'rotate-ccw',
@@ -1253,6 +1288,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return canApplySelectionAction() && !mustGoBackToSelectToolFirst() && rotateEnabled
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'zoom-in',
@@ -1333,6 +1369,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 						editor.getCurrentPageShapeIds().size > 0
 					)
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'toggle-snap-mode',
@@ -1513,6 +1550,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return unlockAllEnabled
 				},
+				disabledDescription: 'action.no-shapes-on-page',
 			},
 			{
 				id: 'toggle-focus-mode',
@@ -1587,6 +1625,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return pageHasShapes
 				},
+				disabledDescription: 'action.no-shapes-on-page',
 			},
 			{
 				id: 'exit-pen-mode',
@@ -1601,6 +1640,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return editor.getInstanceState().isPenMode
 				},
+				disabledDescription: 'action.exit-pen-mode-disabled-description',
 			},
 			{
 				id: 'stop-following',
@@ -1615,6 +1655,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return isFollowingUser
 				},
+				disabledDescription: 'action.stop-following-disabled-description',
 			},
 			{
 				id: 'back-to-content',
@@ -1649,6 +1690,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return !!oneSelected
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'move-to-new-page',
@@ -1670,6 +1712,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				enabled() {
 					return !!(oneSelected && editor.options.maxPages > 1)
 				},
+				disabledDescription: 'action.no-shapes-selected',
 			},
 			{
 				id: 'select-white-color',
@@ -1734,6 +1777,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					const ids = editor.getSelectedShapeIds()
 					return ids.length > 0 && flattenToImagesEnabled
 				},
+				disabledDescription: 'action.flatten-to-image-disabled-description',
 			},
 		]
 
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
index 82f20e51e..d875016f7 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/TLUiTranslationKey.ts
@@ -4,8 +4,11 @@
 /** @public */
 export type TLUiTranslationKey =
 	| 'action.convert-to-bookmark'
+	| 'action.convert-to-bookmark-disabled-description'
 	| 'action.convert-to-embed'
+	| 'action.convert-to-embed-disabled-description'
 	| 'action.open-embed-link'
+	| 'action.align-disabled-description'
 	| 'action.align-bottom'
 	| 'action.align-center-horizontal'
 	| 'action.align-center-vertical'
@@ -17,6 +20,7 @@ export type TLUiTranslationKey =
 	| 'action.back-to-content'
 	| 'action.bring-forward'
 	| 'action.bring-to-front'
+	| 'action.copy-as-disabled-description'
 	| 'action.copy-as-json.short'
 	| 'action.copy-as-json'
 	| 'action.copy-as-png.short'
@@ -27,13 +31,17 @@ export type TLUiTranslationKey =
 	| 'action.cut'
 	| 'action.delete'
 	| 'action.unlock-all'
+	| 'action.distribute-disabled-description'
 	| 'action.distribute-horizontal'
 	| 'action.distribute-vertical'
 	| 'action.distribute-horizontal.short'
 	| 'action.distribute-vertical.short'
 	| 'action.duplicate'
 	| 'action.edit-link'
+	| 'action.edit-link-disabled-description'
 	| 'action.exit-pen-mode'
+	| 'action.exit-pen-mode-disabled-description'
+	| 'action.export-as-disabled-description'
 	| 'action.export-as-json.short'
 	| 'action.export-as-json'
 	| 'action.export-as-png.short'
@@ -50,6 +58,7 @@ export type TLUiTranslationKey =
 	| 'action.export-all-as-svg.long'
 	| 'action.export-all-as-svg'
 	| 'action.fit-frame-to-content'
+	| 'action.fit-frame-to-content-disabled-description'
 	| 'action.flip-horizontal'
 	| 'action.flip-vertical'
 	| 'action.flip-horizontal.short'
@@ -57,20 +66,26 @@ export type TLUiTranslationKey =
 	| 'action.fork-project'
 	| 'action.fork-project-on-tldraw'
 	| 'action.group'
+	| 'action.group-disabled-description'
 	| 'action.insert-embed'
 	| 'action.insert-media'
 	| 'action.leave-shared-project'
+	| 'action.no-shapes-selected'
+	| 'action.no-shapes-on-page'
 	| 'action.new-project'
 	| 'action.new-shared-project'
 	| 'action.open-cursor-chat'
 	| 'action.open-file'
 	| 'action.pack'
 	| 'action.paste'
+	| 'action.paste-disabled-description'
 	| 'action.paste-error-title'
 	| 'action.paste-error-description'
 	| 'action.print'
+	| 'action.redo-disabled-description'
 	| 'action.redo'
 	| 'action.remove-frame'
+	| 'action.remove-frame-disabled-description'
 	| 'action.rename'
 	| 'action.rotate-ccw'
 	| 'action.rotate-cw'
@@ -85,6 +100,7 @@ export type TLUiTranslationKey =
 	| 'action.stack-horizontal.short'
 	| 'action.stack-vertical.short'
 	| 'action.stop-following'
+	| 'action.stop-following-disabled-description'
 	| 'action.stretch-horizontal'
 	| 'action.stretch-vertical'
 	| 'action.stretch-horizontal.short'
@@ -110,6 +126,7 @@ export type TLUiTranslationKey =
 	| 'action.toggle-grid'
 	| 'action.toggle-lock'
 	| 'action.flatten-to-image'
+	| 'action.flatten-to-image-disabled-description'
 	| 'action.toggle-snap-mode.menu'
 	| 'action.toggle-snap-mode'
 	| 'action.toggle-tool-lock.menu'
@@ -117,8 +134,10 @@ export type TLUiTranslationKey =
 	| 'action.toggle-transparent.context-menu'
 	| 'action.toggle-transparent.menu'
 	| 'action.toggle-transparent'
+	| 'action.undo-disabled-description'
 	| 'action.undo'
 	| 'action.ungroup'
+	| 'action.ungroup-disabled-description'
 	| 'action.zoom-in'
 	| 'action.zoom-out'
 	| 'action.zoom-to-100'
diff --git a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
index bb27ef940..9672b48ac 100644
--- a/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
+++ b/packages/tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts
@@ -4,8 +4,13 @@
 /** @internal */
 export const DEFAULT_TRANSLATION = {
 	'action.convert-to-bookmark': 'Convert to Bookmark',
+	'action.convert-to-bookmark-disabled-description':
+		'You need to have a single embed shape selected',
 	'action.convert-to-embed': 'Convert to Embed',
+	'action.convert-to-embed-disabled-description':
+		'You need to have a single bookmark shape selected',
 	'action.open-embed-link': 'Open link',
+	'action.align-disabled-description': 'You need to have at least two shapes selected',
 	'action.align-bottom': 'Align bottom',
 	'action.align-center-horizontal': 'Align horizontally',
 	'action.align-center-vertical': 'Align vertically',
@@ -17,6 +22,7 @@ export const DEFAULT_TRANSLATION = {
 	'action.back-to-content': 'Back to content',
 	'action.bring-forward': 'Bring forward',
 	'action.bring-to-front': 'Bring to front',
+	'action.copy-as-disabled-description': 'You need some shapes to copy',
 	'action.copy-as-json.short': 'JSON',
 	'action.copy-as-json': 'Copy as JSON',
 	'action.copy-as-png.short': 'PNG',
@@ -27,13 +33,17 @@ export const DEFAULT_TRANSLATION = {
 	'action.cut': 'Cut',
 	'action.delete': 'Delete',
 	'action.unlock-all': 'Unlock all',
+	'action.distribute-disabled-description': 'You need to have at least three shapes selected',
 	'action.distribute-horizontal': 'Distribute horizontally',
 	'action.distribute-vertical': 'Distribute vertically',
 	'action.distribute-horizontal.short': 'Distribute H',
 	'action.distribute-vertical.short': 'Distribute V',
 	'action.duplicate': 'Duplicate',
 	'action.edit-link': 'Edit link',
+	'action.edit-link-disabled-description': 'Select a shape that supports link editing',
 	'action.exit-pen-mode': 'Exit pen mode',
+	'action.exit-pen-mode-disabled-description': 'Not in pen mode',
+	'action.export-as-disabled-description': 'You need some shapes to export',
 	'action.export-as-json.short': 'JSON',
 	'action.export-as-json': 'Export as JSON',
 	'action.export-as-png.short': 'PNG',
@@ -50,6 +60,8 @@ export const DEFAULT_TRANSLATION = {
 	'action.export-all-as-svg.long': 'Export all as SVG',
 	'action.export-all-as-svg': 'Export as SVG',
 	'action.fit-frame-to-content': 'Fit to content',
+	'action.fit-frame-to-content-disabled-description':
+		'You need to have a frame with content selected',
 	'action.flip-horizontal': 'Flip horizontally',
 	'action.flip-vertical': 'Flip vertically',
 	'action.flip-horizontal.short': 'Flip H',
@@ -57,21 +69,27 @@ export const DEFAULT_TRANSLATION = {
 	'action.fork-project': 'Fork this project',
 	'action.fork-project-on-tldraw': 'Fork project on tldraw',
 	'action.group': 'Group',
+	'action.group-disabled-description': 'You need to have at least two shapes selected',
 	'action.insert-embed': 'Insert embed',
 	'action.insert-media': 'Upload media',
 	'action.leave-shared-project': 'Leave shared project',
+	'action.no-shapes-selected': 'You need to have some shapes selected',
+	'action.no-shapes-on-page': 'There are no shapes on this page',
 	'action.new-project': 'New project',
 	'action.new-shared-project': 'New shared project',
 	'action.open-cursor-chat': 'Cursor chat',
 	'action.open-file': 'Open file',
 	'action.pack': 'Pack',
 	'action.paste': 'Paste',
+	'action.paste-disabled-description': 'This browser does not support pasting',
 	'action.paste-error-title': 'Pasting failed',
 	'action.paste-error-description':
 		'Could not paste due to missing clipboard permissions. Please enable the permissions and try again.',
 	'action.print': 'Print',
+	'action.redo-disabled-description': 'Nothing to redo',
 	'action.redo': 'Redo',
 	'action.remove-frame': 'Remove frame',
+	'action.remove-frame-disabled-description': 'You need to have a frame selected',
 	'action.rename': 'Rename',
 	'action.rotate-ccw': 'Rotate counterclockwise',
 	'action.rotate-cw': 'Rotate clockwise',
@@ -86,6 +104,7 @@ export const DEFAULT_TRANSLATION = {
 	'action.stack-horizontal.short': 'Stack H',
 	'action.stack-vertical.short': 'Stack V',
 	'action.stop-following': 'Stop following',
+	'action.stop-following-disabled-description': 'Not following anyone',
 	'action.stretch-horizontal': 'Stretch horizontally',
 	'action.stretch-vertical': 'Stretch vertically',
 	'action.stretch-horizontal.short': 'Stretch H',
@@ -111,6 +130,7 @@ export const DEFAULT_TRANSLATION = {
 	'action.toggle-grid': 'Toggle grid',
 	'action.toggle-lock': 'Toggle locked',
 	'action.flatten-to-image': 'Flatten',
+	'action.flatten-to-image-disabled-description': 'You need to have some shapes selected',
 	'action.toggle-snap-mode.menu': 'Always snap',
 	'action.toggle-snap-mode': 'Toggle always snap',
 	'action.toggle-tool-lock.menu': 'Tool lock',
@@ -118,8 +138,10 @@ export const DEFAULT_TRANSLATION = {
 	'action.toggle-transparent.context-menu': 'Transparent',
 	'action.toggle-transparent.menu': 'Transparent',
 	'action.toggle-transparent': 'Toggle transparent background',
+	'action.undo-disabled-description': 'Nothing to undo',
 	'action.undo': 'Undo',
 	'action.ungroup': 'Ungroup',
+	'action.ungroup-disabled-description': 'You need to have a group selected',
 	'action.zoom-in': 'Zoom in',
 	'action.zoom-out': 'Zoom out',
 	'action.zoom-to-100': 'Zoom to 100%',
-- 
2.52.0


From 668541ce8753005a1f859aeb55976a6c51ed2ef8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 18 Sep 2024 15:47:03 +0200
Subject: [PATCH 25/28] Fix undo redo.

---
 packages/tldraw/src/lib/ui/context/actions.tsx | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index dbcdc7bb9..6d8b5dc17 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -18,6 +18,7 @@ import {
 	createShapeId,
 	openWindow,
 	useEditor,
+	useValue,
 } from '@tldraw/editor'
 import * as React from 'react'
 import { kickoutOccludedShapes } from '../../tools/SelectTool/selectHelpers'
@@ -154,6 +155,8 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 	const onlyFlippableShapeSelected = useOnlyFlippableShape()
 	const isFollowingUser = useIsFollowingUser()
 	const [backToContentEnabled] = useShowBackToContent()
+	const undoEnabled = useValue('undo enabled', () => editor.getCanUndo(), [editor])
+	const redoEnabled = useValue('redo enabled', () => editor.getCanRedo(), [editor])
 
 	const getEmbedDefinition = useGetEmbedDefinition()
 
@@ -228,7 +231,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.undo()
 				},
 				enabled() {
-					return editor.getCanUndo()
+					return undoEnabled
 				},
 				disabledDescription: 'action.undo-disabled-description',
 			},
@@ -243,7 +246,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 					editor.redo()
 				},
 				enabled() {
-					return editor.getCanRedo()
+					return redoEnabled
 				},
 				disabledDescription: 'action.redo-disabled-description',
 			},
-- 
2.52.0


From fabede9261d01a52e10665dcdc9cdbe4806d0708 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 18 Sep 2024 15:49:43 +0200
Subject: [PATCH 26/28] Fix export as.

---
 packages/tldraw/src/lib/ui/context/actions.tsx | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index 6d8b5dc17..bd7db2a05 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -332,7 +332,7 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 				},
 				enabled() {
 					const ids = editor.getCurrentPageShapeIds()
-					return !!ids
+					return ids.size > 0
 				},
 				disabledDescription: 'action.export-as-disabled-description',
 			},
-- 
2.52.0


From 95bb7f64e62923f534403e19a021b7d02b763763 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Wed, 18 Sep 2024 16:19:03 +0200
Subject: [PATCH 27/28] Fix deps.

---
 packages/tldraw/src/lib/ui/context/actions.tsx | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/packages/tldraw/src/lib/ui/context/actions.tsx b/packages/tldraw/src/lib/ui/context/actions.tsx
index bd7db2a05..be32436d7 100644
--- a/packages/tldraw/src/lib/ui/context/actions.tsx
+++ b/packages/tldraw/src/lib/ui/context/actions.tsx
@@ -1826,6 +1826,8 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 		addDialog,
 		editLinkEnabled,
 		insertMedia,
+		undoEnabled,
+		redoEnabled,
 		exportAs,
 		defaultDocumentName,
 		pageHasShapes,
@@ -1833,10 +1835,11 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 		convertToBookmarkEnabled,
 		getEmbedDefinition,
 		convertToEmbedEnabled,
+		oneSelected,
+		isInSelectState,
 		allowUngroup,
 		allowGroup,
 		twoSelected,
-		isInSelectState,
 		removeFrameEnabled,
 		fitFrameToContentEnabled,
 		alignEnabled,
@@ -1846,7 +1849,6 @@ export function ActionsProvider({ overrides, children }: ActionsProviderProps) {
 		stackingEnabled,
 		reorderingEnabled,
 		cut,
-		oneSelected,
 		copy,
 		paste,
 		addToast,
-- 
2.52.0


From 4d4d184e90f9f5a9b7971c0fd4640cc131f03fc7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mitja=20Bezen=C5=A1ek?= <mitja.bezensek@gmail.com>
Date: Thu, 26 Sep 2024 15:44:30 +0200
Subject: [PATCH 28/28] Fix.

---
 apps/examples/src/hooks/useDebugging.tsx | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/apps/examples/src/hooks/useDebugging.tsx b/apps/examples/src/hooks/useDebugging.tsx
index 3b794588d..3434379b9 100644
--- a/apps/examples/src/hooks/useDebugging.tsx
+++ b/apps/examples/src/hooks/useDebugging.tsx
@@ -27,6 +27,9 @@ export function useDebugging(): TLUiOverrides {
 				label: 'Log shapes',
 				readonlyOk: true,
 				kbd: '?!l',
+				enabled() {
+					return true
+				},
 			} as TLUiActionItem
 
 			actions['track-changes'] = {
@@ -45,6 +48,9 @@ export function useDebugging(): TLUiOverrides {
 				label: 'Track changes',
 				checkbox: true,
 				readonlyOk: true,
+				enabled() {
+					return true
+				},
 			} as TLUiActionItem
 
 			return actions
-- 
2.52.0

